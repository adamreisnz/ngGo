/**
 * ng-go - v1.3.1 - 2-11-2015
 * https://github.com/adambuczynski/ngGo
 *
 * Copyright (c) 2015 Adam Buczynski <me@adambuczynski.com>
 * License: MIT
 */
!function(t,e,o){"use strict";e.module("ngGo",[]).constant("ngGo",{name:"ngGo",version:"1.3.1",error:{POSITION_OUT_OF_BOUNDS:1,POSITION_ALREADY_HAS_STONE:2,POSITION_IS_SUICIDE:3,POSITION_IS_REPEATING:4,NO_DATA:5,UNKNOWN_DATA:6,INVALID_SGF:7,INVALID_GIB:8,INVALID_JGF_JSON:9,INVALID_JGF_TREE_JSON:10}}).constant("StoneColor",{E:0,EMPTY:0,B:1,BLACK:1,W:-1,WHITE:-1}).constant("MarkupTypes",{TRIANGLE:"triangle",CIRCLE:"circle",SQUARE:"square",MARK:"mark",SELECT:"select",LABEL:"label",LAST:"last",SAD:"sad",HAPPY:"happy"}).constant("PlayerModes",{PLAY:"play",REPLAY:"replay",EDIT:"edit",SOLVE:"solve"}).constant("PlayerTools",{NONE:"none",MOVE:"move",SCORE:"score",SETUP:"setup",MARKUP:"markup"}).constant("KeyCodes",{LEFT:37,RIGHT:39,UP:38,DOWN:40,ESC:27,ENTER:13,SPACE:32,TAB:9,SHIFT:16,CTRL:17,ALT:18,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Directive",["ngGo.Board.Service"]).directive("board",["$window","Board",function(o,i){var r=t.pixelRatio||1,s=function(t){var e=document.createElement("canvas"),o=e.getContext("2d");return r>1&&o.scale(r,r),e.className=t,e.width=this.clientWidth*r,e.height=this.clientHeight*r,this.appendChild(e),o},a=function(t,e,o){var i,r,s;return 0===o&&e>0&&(o=e),t.Board.width&&t.Board.height?(s=Math.min(e/t.Board.width,o/t.Board.height),i=Math.floor(s*t.Board.width),r=Math.floor(s*t.Board.height)):i=r=Math.min(e,o),t.lastDrawWidth!==i||t.lastDrawHeight!==r?(t.lastDrawWidth=i,t.lastDrawHeight=r,t.$broadcast("ngGo.board.drawSizeChanged",i,r),!0):!1};return{restrict:"E",scope:{instance:"&"},link:function(t,n,h){var l,c,d,u,f=n.parent(),p=n[0],g=!0;if(t.lastDrawWidth=0,t.lastDrawHeight=0,t.Board=t.instance(),"function"==typeof t.Board&&(t.Board=t.Board()),t.Board||(g=!1,t.Board=new i),t.Board.linkElement(n),"PLAYER"===f[0].tagName&&(u=f,p=f.parent()[0]),t.$on("ngGo.board.drawSizeChanged",function(e,o,i){var s=n.find("canvas");for(l=0;l<s.length;l++)s[l].width=o*r,s[l].height=i*r;(u||"true"===h.forceSize)&&n.css({width:o+"px",height:i+"px"}),t.Board.setDrawSize(o*r,i*r)}),a(t,p.clientWidth,p.clientHeight),e.element(o).on("resize",function(){a(t,p.clientWidth,p.clientHeight)}),t.$on("ngGo.board.determineDrawSize",function(){a(t,p.clientWidth,p.clientHeight)}),t.$on("ngGo.board.resize",function(e,o){o===t.Board&&(a(t,p.clientWidth,p.clientHeight)||t.Board.resized())}),h["static"]&&"true"===h["static"])for(n.addClass("static"),t.Board.makeStatic(),c=s.call(n[0],"static"),l=0;l<t.Board.layerOrder.length;l++)d=t.Board.layerOrder[l],t.Board.layers[d].setContext(c);else for(l=0;l<t.Board.layerOrder.length;l++)d=t.Board.layerOrder[l],c=s.call(n[0],d),t.Board.layers[d].setContext(c);h.$observe("size",function(e){"string"==typeof e&&-1!==e.toLowerCase().indexOf("x")?(e=e.split("x"),t.Board.setSize(e[0],e[1])):t.Board.setSize(e,e)}),h.$observe("coordinates",function(e){t.Board.toggleCoordinates("true"===e)}),h.$observe("cutoff",function(o){e.isDefined(o)&&t.Board.setCutoff(o.split(","))}),h.$observe("colorMultiplier",function(o){e.isDefined(o)&&t.Board.swapColors(o)}),t.$parent.Player&&t.$parent.Player.setBoard(t.Board),g&&t.Board.redraw()}}}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Service",["ngGo","ngGo.Board.Directive","ngGo.Board.Theme.Service","ngGo.Board.Layer.GridLayer.Service","ngGo.Board.Layer.ShadowLayer.Service","ngGo.Board.Layer.StonesLayer.Service","ngGo.Board.Layer.MarkupLayer.Service","ngGo.Board.Layer.ScoreLayer.Service","ngGo.Board.Layer.HoverLayer.Service","ngGo.Board.Object.Markup.Service","ngGo.Board.Object.Stone.Service","ngGo.Board.Object.StoneMini.Service","ngGo.Board.Object.StoneFaded.Service"]).provider("Board",function(){var t={width:0,height:0,cutoff:[],section:{top:0,right:0,bottom:0,left:0},coordinates:!1,colorMultiplier:1};this.setConfig=function(o){t=e.extend(t,o)},this.$get=["$rootScope","$injector","BoardTheme",function(o,i,r){var s=function(t){this.init(),this.parseConfig(t||{})};return s.prototype.init=function(){this.removeAll(),this.theme=new r,this.cellSize=0,this.drawWidth=0,this.drawHeight=0,this.drawMarginHor=0,this.drawMarginVer=0,this.gridDrawWidth=0,this.gridDrawHeight=0,this.layerOrder=["grid","shadow","stones","score","markup","hover"],this.layers={};for(var t=0;t<this.layerOrder.length;t++){var e=this.layerOrder[t],o=e[0].toUpperCase()+e.substr(1)+"Layer",s=i.get(o);this.layers[e]=new s(this)}this["static"]=!1,this.margin=this.theme.get("board.margin"),this.colorMultiplier=1,this.coordinates=!1,this.layers.grid.setCoordinates(!1),this.width=0,this.height=0,this.cutoff={top:!1,left:!1,right:!1,bottom:!1},this.section={top:0,left:0,right:0,bottom:0}},s.prototype.linkElement=function(t){this.element=t},s.prototype.makeStatic=function(){this["static"]=!0,this.layerOrder=["grid","stones","markup"]},s.prototype.parseConfig=function(o){"object"==typeof o&&(o=e.extend({},t,o),this.toggleCoordinates(o.coordinates),this.swapColors(o.colorMultiplier),this.setCutoff(o.cutoff),this.setSection(o.section),this.setSize(o.width,o.height))},s.prototype.setMargin=function(t){return"undefined"==typeof t&&(t=this.theme.get("board.margin")),this.margin!==t&&(this.margin=t,this.resized()),this},s.prototype.setCutoff=function(t){t&&e.isArray(t)||(t=[]);var o=!1;for(var i in this.cutoff)this.cutoff.hasOwnProperty(i)&&(-1!==t.indexOf(i)?this.cutoff[i]||(this.cutoff[i]=!0,o=!0):this.cutoff[i]&&(this.cutoff[i]=!1,o=!0));return o&&this.resized(),this},s.prototype.setSection=function(t){return t&&"object"==typeof t?(t=e.extend({top:0,left:0,right:0,bottom:0},t),this.section.top===t.top&&this.section.bottom===t.bottom&&this.section.left===t.left&&this.section.right===t.right?this:(this.section=t,this.resized(),this)):this},s.prototype.setSize=function(t,e){if(t=parseInt(t||e||0),e=parseInt(e||t||0),!isNaN(t)&&!isNaN(e)){if(t!==this.width||e!==this.height){this.width=t,this.height=e;for(var i in this.layers)this.layers.hasOwnProperty(i)&&this.layers[i].setSize(t,e);o.$broadcast("ngGo.board.resize",this,t,e)}return this}},s.prototype.setDrawSize=function(t,e){(t!==this.drawWidth||e!==this.drawHeight)&&(this.drawWidth=t,this.drawHeight=e,this.resized())},s.prototype.toggleCoordinates=function(t){"undefined"!=typeof t?this.coordinates=t:this.coordinates=!this.coordinates,this.layers.grid.setCoordinates(this.coordinates),this.coordinates?this.setMargin(this.theme.get("coordinates.margin")):this.setMargin(this.theme.get("board.margin"))},s.prototype.swapColors=function(t){if("undefined"==typeof t)t=-this.colorMultiplier;else if(t=parseInt(t),isNaN(t))return;t!==this.colorMultiplier&&(this.colorMultiplier=t,this["static"]?this.redraw():(this.redraw("stones"),this.redraw("markup")))},s.prototype.getTheme=function(){return this.theme},s.prototype.setTheme=function(t){return this.theme=t,this},s.prototype.add=function(t,e,o,i){"undefined"!=typeof this.layers[t]&&this.layers[t].add(e,o,i)},s.prototype.remove=function(t,e,o){"undefined"!=typeof this.layers[t]&&this.layers[t].remove(e,o)},s.prototype.get=function(t,e,o){return this.layers[t]&&this.layers[t].get(e,o)},s.prototype.has=function(t,e,o){return this.layers[t]&&this.layers[t].has(e,o)},s.prototype.setAll=function(t,e){"undefined"!=typeof this.layers[t]&&this.layers[t].setAll(e)},s.prototype.removeAll=function(t){if(t)"undefined"!=typeof this.layers[t]&&this.layers[t].removeAll();else for(t in this.layers)this.layers.hasOwnProperty(t)&&this.layers[t].removeAll()},s.prototype.updatePosition=function(t,e){this.width&&this.height||this.setSize(t.width,t.height),e&&this.removeAll("markup"),this.setAll("stones",t.stones),this.setAll("markup",t.markup)},s.prototype.getState=function(t){if(t)return this.layers[t]?this.layers[t].getAll():null;var e={};for(t in this.layers)if(this.layers.hasOwnProperty(t)){var o=this.layers[t].getAll();o&&!o.isEmpty()&&(e[t]=o)}return e},s.prototype.restoreState=function(t,e){if(e)return void(this.layers[e]&&this.layers[e].setAll(t));for(e in this.layers)this.layers.hasOwnProperty(e)&&(this.layers[e].removeAll(),t[e]&&this.layers[e].setAll(t[e]))},s.prototype.clear=function(t){if(t){if(this["static"]||!this.layers[t])return;return void this.layers[t].clear()}if(this["static"])return void this.layers.stones.clear();for(t in this.layers)this.layers.hasOwnProperty(t)&&this.layers[t].clear()},s.prototype.redraw=function(t){if(this.width&&this.height&&this.drawWidth&&this.drawHeight){if(t){if(this["static"]||!this.layers[t])return;return void this.layers[t].redraw()}this.clear();for(var e=0;e<this.layerOrder.length;e++)t=this.layerOrder[e],this.layers[t].draw()}},s.prototype.resized=function(){if(this.grid={xLeft:0+this.section.left,xRight:this.width-1-this.section.right,yTop:0+this.section.top,yBot:this.height-1-this.section.bottom},this.width&&this.height&&this.drawWidth&&this.drawHeight){var t=this.width+this.margin,e=this.height+this.margin;for(var o in this.cutoff)this.cutoff[o]&&("top"===o||"bottom"===o?e+=.5:t+=.5);this.cellSize=Math.floor(Math.min(this.drawWidth/t,this.drawHeight/e)),this.gridDrawWidth=this.cellSize*(t-this.margin-1),this.gridDrawHeight=this.cellSize*(e-this.margin-1),this.drawMarginHor=Math.floor((this.drawWidth-this.gridDrawWidth)/2),this.drawMarginVer=Math.floor((this.drawHeight-this.gridDrawHeight)/2),this.redraw()}},s.prototype.getCellSize=function(){return this.cellSize},s.prototype.getAbsX=function(t){var e=this.cutoff.left?.5:0;return this.drawMarginHor+Math.round((t+e)*this.cellSize)},s.prototype.getAbsY=function(t){var e=this.cutoff.top?.5:0;return this.drawMarginVer+Math.round((t+e)*this.cellSize)},s.prototype.getGridX=function(t){var e=this.cutoff.left?.5:0;return Math.round((t-this.drawMarginHor)/this.cellSize-e)},s.prototype.getGridY=function(t){var e=this.cutoff.top?.5:0;return Math.round((t-this.drawMarginVer)/this.cellSize-e)},s.prototype.isOnBoard=function(t,e){return t>=this.grid.xLeft&&e>=this.grid.yTop&&t<=this.grid.xRight&&e<=this.grid.yBot},s}]})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.DefaultClearHandler.Service",["ngGo"]).factory("DefaultClearHandler",function(){return function(t,e){if(t){var o=this.board.getAbsX(e.x),i=this.board.getAbsY(e.y),r=this.board.getCellSize(),s=this.board.theme.get("stone.radius",r);t.clearRect(o-s,i-s,2*s,2*s)}}})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Grid.Service",["ngGo","ngGo.Board.GridChanges.Service"]).factory("BoardGrid",["BoardGridChanges",function(t){var o=function(t,o,i){var r={x:t,y:o};return"object"==typeof this.grid[t][o]?e.extend(r,this.grid[t][o]):(r[i]=this.grid[t][o],r)},i=function(t,e,o){this.width=0,this.height=0,this.grid=[],this.emptyValue=null,"undefined"!=typeof o&&(this.emptyValue=o),(t||e)&&this.setSize(t,e)};return i.prototype.set=function(t,e,o){this.isOnGrid(t,e)&&(this.grid[t][e]=o)},i.prototype.unset=function(t,e){this.isOnGrid(t,e)&&(this.grid[t][e]=this.emptyValue)},i.prototype.has=function(t,e){return this.isOnGrid(t,e)&&this.grid[t][e]!==this.emptyValue},i.prototype.is=function(t,e,o){return this.isOnGrid(t,e)&&this.grid[t][e]===o},i.prototype.get=function(t,e,i){return this.isOnGrid(t,e)&&this.grid[t][e]!==this.emptyValue?i?o.call(this,t,e,i):this.grid[t][e]:this.emptyValue},i.prototype.all=function(t){if(!t)return this.grid;for(var e=[],i=0;i<this.width;i++)for(var r=0;r<this.height;r++)this.grid[i][r]!==this.emptyValue&&e.push(o.call(this,i,r,t));return e},i.prototype.isEmpty=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)if(this.grid[t][e]!==this.emptyValue)return!1;return!0},i.prototype.populate=function(t){for(var e=0;e<this.width;e++)for(var o=0;o<this.height;o++)this.grid[e][o]=t},i.prototype.empty=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.grid[t][e]=this.emptyValue},i.prototype.clone=function(){var t=new i;return t.grid=e.copy(this.grid),t.emptyValue=this.emptyValue,t.width=this.width,t.height=this.height,t},i.prototype.isSameAs=function(t){if(this.width!==t.width||this.height!==t.height)return!1;for(var e=0;e<this.width;e++)for(var o=0;o<this.height;o++)if(this.grid[e][o]!==t[e][o])return!1;return!0},i.prototype.compare=function(e,i){var r=new t;if(this.width!==e.width||this.height!==e.height)return console.warn("Trying to compare grids of a different size"),r;for(var s=0;s<this.width;s++)for(var a=0;a<this.height;a++)e.grid[s][a]!==this.emptyValue&&e.grid[s][a]!==this.grid[s][a]&&r.add.push(o.call(e,s,a,i)),this.grid[s][a]!==this.emptyValue&&e.grid[s][a]!==this.grid[s][a]&&r.remove.push(o.call(this,s,a,i));return r},i.prototype.isOnGrid=function(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height},i.prototype.whenEmpty=function(t){this.emptyValue=t},i.prototype.setSize=function(t,e){t=t||e||0,e=e||t||0,this.width=parseInt(t),this.height=parseInt(e),this.grid=[];for(var o=0;o<this.width;o++){this.grid[o]=[];for(var i=0;i<this.height;i++)this.grid[o][i]=this.emptyValue}},i.prototype.getSize=function(){return{width:this.width,height:this.height}},i}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.GridChanges.Service",["ngGo"]).factory("BoardGridChanges",function(){var t=function(t,e){for(var o,i=[],r=0;r<t.length;r++){o=!0;for(var s in e)if(t[r].x===e[s].x&&t[r].y===e[s].y){o=!1;break}o&&i.push(t[r])}return i};return function(){this.add=[],this.remove=[],this.concat=function(e){this.add=t(this.add,e.remove).concat(e.add),this.remove=t(this.remove,e.add).concat(e.remove)},this.has=function(){return!(!this.add.length&&!this.remove.length)}}})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.Service",["ngGo","ngGo.Board.Grid.Service"]).factory("BoardLayer",["BoardGrid",function(t){var e=function(e,o){this.board=e,this.context=o,this.grid=new t};return e.prototype.setSize=function(t,e){this.grid.setSize(t,e)},e.prototype.getAll=function(){return this.grid.clone()},e.prototype.setAll=function(t){this.grid=t.clone()},e.prototype.removeAll=function(){this.clear(),this.grid.empty()},e.prototype.add=function(t,e,o){this.clearCell(t,e),this.grid.set(t,e,o),this.drawCell(t,e)},e.prototype.remove=function(t,e){this.clearCell(t,e),this.grid.unset(t,e)},e.prototype.get=function(t,e){return this.grid.get(t,e)},e.prototype.has=function(t,e){return this.grid.has(t,e)},e.prototype.draw=function(){},e.prototype.clear=function(){this.context&&this.context.clearRect(0,0,this.context.canvas.clientWidth,this.context.canvas.clientHeight)},e.prototype.redraw=function(){this.clear(),this.draw()},e.prototype.drawCell=function(){},e.prototype.clearCell=function(){},e.prototype.redrawCell=function(t,e){this.clearCell(t,e),this.drawCell(t,e)},e.prototype.setContext=function(t){this.context=t},e.prototype.getContext=function(){return this.context},e}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.Service",["ngGo","ngGo.Board.DefaultClearHandler.Service"]).factory("BoardObject",["DefaultClearHandler",function(t){var e={draw:function(){0===this.board.drawWidth||0===this.board.drawheight},clear:function(e){t.call(this,this.context,e)}};return e}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.ShellPattern.Service",["ngGo"]).factory("ShellPattern",function(){var t=function(t,e,o,i,r,s,a){t.shadowBlur=2,t.strokeStyle=a,t.lineWidth=i/30*this.thickness,t.beginPath(),i-=Math.max(1,t.lineWidth);var n,h,l=e+i*Math.cos(r*Math.PI),c=o+i*Math.sin(r*Math.PI),d=e+i*Math.cos(s*Math.PI),u=o+i*Math.sin(s*Math.PI);d>l?(n=(u-c)/(d-l),h=Math.atan(n)):d===l?h=Math.PI/2:(n=(u-c)/(d-l),h=Math.atan(n)-Math.PI);var f=this.factor*i,p=Math.sin(h)*f,g=Math.cos(h)*f,m=l+p,y=c-g,v=d+p,b=u-g;t.moveTo(l,c),t.bezierCurveTo(m,y,v,b,d,u),t.stroke()};return function(e,o,i,r,s,a){for(var n=s,h=s,l=0;l<this.lines.length;l++)n+=this.lines[l],h-=this.lines[l],t.call(this,e,o,i,r,n,h,a)}})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Theme.Service",["ngGo"]).provider("BoardTheme",["StoneColor","MarkupTypes",function(t,o){var i={board:{margin:.25},stone:{style:"shell",shadow:!0,radius:function(t){return Math.floor(t/2)},shell:{color:function(e){return e===t.B?"#111":"#BFBFBA"},stroke:"rgba(128,128,128,0.15)",types:[{lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.15,thickness:1.75},{lines:[.1,.09,.08,.07,.09,.06,.06,.07,.07,.06,.06],factor:.1,thickness:1.5},{lines:[.22,.11,.13,.06,.11,.09],factor:.05,thickness:1.75},{lines:[.18,.23,.09,.17,.14],factor:.1,thickness:2}]},mono:{lineWidth:1,lineColor:function(){return"#000"},color:function(e){return e===t.B?"#000":"#fff"}},mini:{scale:.5,alpha:1},faded:{scale:1,alpha:function(e){return e===t.B?.3:.4}}},shadow:{color:"rgba(40,30,20,0.5)",size:function(t){return Math.floor(t/20)},blur:function(t){return t/20},offsetX:function(t){return Math.ceil(t/20)},offsetY:function(t){return Math.ceil(t/20)}},markup:{color:function(e){return e===t.B?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.9)"},lineWidth:function(t){return Math.max(1,Math.floor(t/16))},triangle:{scale:.85},square:{scale:.85},circle:{scale:.55},mark:{lineCap:"square",scale:.75},last:{scale:.7},smiley:{lineCap:"round",scale:.85},label:{font:"Arial"},variation:{type:o.LABEL,text:function(t){return String.fromCharCode(65+t)},color:"rgba(86,114,30,0.9)"},solution:{valid:{type:o.SELECT,text:null,color:"rgba(86,114,30,1)",scale:.5},invalid:{type:o.MARK,text:null,color:"rgba(237,9,15,1)",scale:.3}}},grid:{lineColor:"rgba(60,40,15,1)",lineWidth:function(t){return t>60?2:t>50?1.5:1},lineCap:"square",star:{color:"rgba(60,40,15,1)",radius:function(t){return t>50?Math.floor(t/16+1):t>30?3:t>15?2:t>5?1.5:1},points:function(t,e){return t===e&&19===t?[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}]:t===e&&13===t?[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}]:t===e&&9===t?[{x:4,y:4},{x:2,y:2},{x:2,y:6},{x:6,y:2},{x:6,y:6}]:[]}}},coordinates:{color:"rgba(101,69,37,0.5)",margin:1.25,vertical:{font:"Arial",style:"numbers",inverse:!0,size:function(){return function(t,e){return Math.floor(.3*e+1)+"px"}}},horizontal:{font:"Arial",style:"letters",inverse:!1,size:function(){return function(t,e){return Math.floor(.3*e+1)+"px"}}}}};this.setTheme=function(t){t&&(i=e.merge(i,t))},this.$get=function(){var t=function(t){this.instanceTheme=t,this.reset()};return t.prototype.reset=function(){this.theme=e.copy(i),this.instanceTheme&&e.merge(this.theme,this.instanceTheme)},t.prototype.get=function(t){for(var e=t.split("."),o=this.theme,i=0;i<e.length;i++){if("undefined"==typeof o[e[i]])return console.warn("Could not find theme property",t),null;o=o[e[i]]}if("function"!=typeof o)return o;var r=[];if(arguments.length>1)for(var s=1;s<arguments.length;s++)r.push(arguments[s]);return o.apply(this,r)},t.prototype.set=function(t,e){for(var o=t.split("."),i=this.theme,r=0;r<o.length;r++){if(r+1===o.length){i[o[r]]=e;break}"undefined"==typeof i[o[r]]&&(i[o[r]]={}),i=i[o[r]]}return this},t.prototype.canvasTranslate=function(t){return"undefined"==typeof t&&(t=this.get("grid.lineWidth")),t%2*.5},t}}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Errors.InvalidDataError.Service",["ngGo"]).factory("InvalidDataError",["ngGo",function(t){var e=function(e){switch(this.code=e,this.name="InvalidDataError",this.message="Invalid data: ",e){case t.error.NO_DATA:this.message+="no data to process.";break;case t.error.UNKNOWN_DATA:this.message+="unknown data format.";break;case t.error.INVALID_GIB:this.message+="unable to parse GIB data.";break;case t.error.INVALID_SGF:this.message+="unable to parse SGF data.";break;case t.error.INVALID_JGF_JSON:this.message+="unable to parse JGF data.";break;case t.error.INVALID_JGF_TREE_JSON:this.message+="unable to parse the JGF tree data.";break;default:this.message+="unable to parse the data."}};return e.prototype=new Error,e.prototype.constructor=e,e}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Errors.InvalidPositionError.Service",["ngGo"]).factory("InvalidPositionError",["ngGo","StoneColor",function(t,e){var o=function(o,i,r,s){switch(this.code=o,this.name="InvalidPositionError",this.message="Invalid position detected.","undefined"!=typeof i&&"undefined"!=typeof r&&"undefined"!=typeof s&&(this.message+=" Trying to place a "+(s===e.W?"white":"black")+" stone on ("+i+", "+r+")"),o){case t.error.POSTITION_OUT_OF_BOUNDS:this.message+=", but these coordinates are not on the board.";break;case t.error.POSTITION_ALREADY_HAS_STONE:this.message+=", but there is already a stone on those coordinates.";break;case t.error.POSTITION_IS_SUICIDE:this.message+=", but that would be suicide.";break;case t.error.POSTITION_IS_REPEATING:this.message+=", but this position already occured.";break;default:this.message+="."}};return o.prototype=new Error,o.prototype.constructor=o,o}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Service",["ngGo","ngGo.Game.Path.Service","ngGo.Game.Node.Service","ngGo.Game.Position.Service","ngGo.Kifu.Blank.Service","ngGo.Kifu.Parser.Service","ngGo.Errors.InvalidDataError.Service","ngGo.Errors.InvalidPositionError.Service"]).provider("Game",function(){var t={defaultSize:0,defaultKomi:0,defaultHandicap:0,rememberPath:!0,checkRepeat:"KO",allowSuicide:!1};this.setConfig=function(o){t=e.extend(t,o)},this.$get=["ngGo","StoneColor","GamePath","GameNode","GamePosition","KifuParser","KifuBlank","InvalidDataError","InvalidPositionError",function(i,r,s,a,n,h,l,c,d){var u=function(){this.info.board||(this.info.board={}),this.info.game||(this.info.game={}),"undefined"==typeof this.info.board.width&&(this.info.board.width=this.config.defaultSize),"undefined"==typeof this.info.board.height&&(this.info.board.height=this.config.defaultSize),"undefined"==typeof this.info.game.komi&&(this.info.game.komi=this.config.defaultKomi),"undefined"==typeof this.info.game.handicap&&(this.info.game.handicap=this.config.defaultHandicap)},f=function(t){return 0===this.node.children.length?!1:(t===o&&(t=this.node.rememberedPath),t=t||0,-1===t&&(t=0),t>=this.node.children.length||!this.node.children[t]?!1:(this.path.advance(t),this.node=this.node.children[t],!0))},p=function(){return this.node.parent?(this.path.retreat(),this.node=this.node.parent,!0):!1},g=function(){this.path.reset(),this.node=this.root,this.setTurn(this.info.game.handicap>1?r.W:r.B)},m=function(){1!==this.history.length&&(this.history=[],this.history.push(new n),this.info.board&&this.history[0].setSize(this.info.board.width,this.info.board.height))},y=function(t){return t||(t=this.position.clone()),this.history.push(t),t},v=function(){return 0===this.history.length?null:this.history.pop()},b=function(t){t&&(this.history.pop(),this.history.push(t))},w=function(){this.node.parent&&(this.node.parent.rememberedPath=this.node.parent.children.indexOf(this.node));var t,e=this.position.clone();if(this.node.isMove()&&(this.node.move.pass?e.setTurn(-this.node.move.color):this.validateMove(this.node.move.x,this.node.move.y,this.node.move.color,e)),this.node.turn&&e.setTurn(this.node.turn),this.node.setup)for(t in this.node.setup)this.node.setup.hasOwnProperty(t)&&e.stones.set(this.node.setup[t].x,this.node.setup[t].y,this.node.setup[t].color);if(this.node.markup)for(t in this.node.markup)this.node.markup.hasOwnProperty(t)&&e.markup.set(this.node.markup[t].x,this.node.markup[t].y,this.node.markup[t]);y.call(this,e)},S=function(o,i){this.config=e.extend({},t,i||{}),Object.defineProperty(this,"position",{get:function(){return this.history[this.history.length-1]},set:function(t){this.history[this.history.length]=t}}),o?this.load(o):this.init()};return S.prototype.init=function(){this.info={},this.root=null,this.node=null,this.path=new s,this.jgf=null,this.history=[]},S.prototype.load=function(t){this.init();try{this.fromData(t)}catch(e){throw m.call(this),new c(e)}this.first()},S.prototype.reload=function(){this.jgf&&this.load(this.jgf)},S.prototype.isLoaded=function(){return null!==this.root},S.prototype.clone=function(){for(var t=new S,o=Object.getOwnPropertyNames(this),i=0;i<o.length;i++)t[i]=e.copy(this[i]);return t},S.prototype.fromData=function(t){if(!t)throw i.error.NO_DATA;if("string"==typeof t){var e=t.charAt(0);if("("===e)return this.fromSgf(t);if("{"===e||"["===e)return this.fromJgf(t);if("\\"===e)return this.fromGib(t);throw i.error.UNKNOWN_DATA}if("object"!=typeof t)throw i.error.UNKNOWN_DATA;this.fromJgf(t)},S.prototype.fromGib=function(t){var e=h.gib2jgf(t);if(!e)throw i.error.INVALID_GIB;this.fromJgf(e)},S.prototype.fromSgf=function(t){var e=h.sgf2jgf(t);if(!e)throw i.error.INVALID_SGF;this.fromJgf(e)},S.prototype.fromJgf=function(t){if("string"==typeof t)try{t=e.fromJson(t)}catch(o){throw i.error.INVALID_JGF_JSON}if(e.isArray(t)&&(t={tree:t}),"string"==typeof t.tree)if("["===t.tree.charAt(0))try{t.tree=e.fromJson(t.tree)}catch(o){throw i.error.INVALID_JGF_TREE_JSON}else t.tree=[];for(var r in t)t.hasOwnProperty(r)&&"tree"!==r&&(this.info[r]=e.copy(t[r]));u.call(this),this.root=new a,t.tree&&this.root.fromJgf(t.tree),this.jgf=t},S.prototype.toSgf=function(){return h.jgf2sgf(this.toJgf())},S.prototype.toJgf=function(t){for(var o=l.jgf(),i=Object.getOwnPropertyNames(this),r=0;r<i.length;r++)"root"!==r&&(o[r]?o[r]=e.extend(o[r],this[r]):o[r]=e.copy(this[r]));return o.tree=this.root.toJgf(),t?e.toJson(o):o},S.prototype.getNode=function(){return this.node},S.prototype.getNodes=function(){for(var t=this.root,e=[t];t;)t=t.getChild(t.rememberedPath),t&&e.push(t);return e},S.prototype.getMoveNode=function(t){var e=this.getMoveNodes(t,t);return e.length?e[0]:null},S.prototype.getMoveNodes=function(t,e){var o=this.getNodes();return t=t||1,e=e||o.length,o.filter(function(o){if(o.isMove()){var i=o.getMoveNumber();return i>=t&&e>=i}return!1})},S.prototype.getMove=function(){return this.node?this.node.getMoveNumber():0},S.prototype.getMoveCount=function(){var t=this.getMoveNodes();return t.length},S.prototype.getMoveVariation=function(t,e){return this.node?this.node.getMoveVariation(t,e):-1},S.prototype.getPosition=function(){return this.position},S.prototype.getPath=function(t){return t?this.path.clone():this.path},S.prototype.clonePath=function(){return this.path.clone()},S.prototype.getPathToNode=function(t){return s.findNode(t,this.root)},S.prototype.getKomi=function(){var t=this.get("game.komi",0);return parseFloat(t)},S.prototype.setKomi=function(t){"undefined"==typeof t&&(t=this.config.defaultKomi),this.info.game.komi=parseFloat(t)},S.prototype.getName=function(){return this.get("game.name","")},S.prototype.getResult=function(){return this.get("game.result","")},S.prototype.getTurn=function(){return this.history.length?this.position.getTurn():r.B},S.prototype.setTurn=function(t){this.history.length&&this.position.setTurn(t)},S.prototype.getCaptureCount=function(){var t={};t[r.B]=0,t[r.W]=0;for(var e=0;e<this.history.length;e++)t[r.B]+=this.history[e].getCaptureCount(r.B),t[r.W]+=this.history[e].getCaptureCount(r.W);return t},S.prototype.get=function(t,e){if(t){"string"==typeof t&&(t=t.split("."));for(var o,i=this.info,r=0;r<t.length;r++){if(o=t[r],r+1===t.length)return"undefined"==typeof i[o]?e:i[o];if("object"!=typeof i[o])return console.warn("Game info property",o,"is not an object"),e;i=i[o]}}},S.prototype.isOnBoard=function(t,e){return t>=0&&e>=0&&t<this.info.board.width&&e<this.info.board.height},S.prototype.isMoveVariation=function(t,e){return this.node?this.node.isMoveVariation(t,e):!1},S.prototype.isRepeatingPosition=function(t){var e;if("KO"===this.checkRepeat&&this.history.length-2>=0)e=this.history.length-2;else{if("ALL"!==this.checkRepeat)return!1;e=0}for(var o=this.history.length-2;o>=e;o--)if(t.isSameAs(this.history[o]))return!0;return!1},S.prototype.isValidMove=function(t,e,o){try{return this.validateMove(t,e,o),!0}catch(i){return!1}},S.prototype.validateMove=function(t,e,o,s){if(!this.isOnBoard(t,e))throw new d(i.error.POSTITION_OUT_OF_BOUNDS,t,e,o);if(this.position.stones.get(t,e)!==r.EMPTY)throw new d(i.error.POSTITION_ALREADY_HAS_STONE,t,e,o);o=o||this.position.getTurn(),s=s||this.position.clone(),s.stones.set(t,e,o);var a=s.captureAdjacent(t,e);if(!a&&!s.hasLiberties(t,e)){if(!this.allowSuicide)throw new d(i.error.POSTITION_IS_SUICIDE,t,e,o);s.captureGroup(t,e)}if(this.checkRepeat&&this.isRepeatingPosition(s))throw new d(i.error.POSTITION_IS_REPEATING,t,e,o);return s.setTurn(-o),s},S.prototype.validatePlacement=function(t,e,o,s){if(!this.isOnBoard(t,e))throw new d(i.error.POSTITION_OUT_OF_BOUNDS,t,e,o);if(s.stones.set(t,e,o),o!==r.EMPTY){var a=s.captureAdjacent(t,e);a||s.hasLiberties(t,e)||s.captureGroup(t,e)}},S.prototype.addStone=function(t,e,o){if(!this.position.stones.is(t,e,o)){var i=this.position.clone();if(this.validatePlacement(t,e,o,i),"undefined"==typeof this.node.setup){if(this.node.isMove()){y.call(this);var r=new a,s=r.appendTo(this.node);this.node=r,this.path.advance(s)}this.node.setup=[]}b.call(this,i),this.node.setup.push(this.position.stones.get(t,e,"color"))}},S.prototype.addMarkup=function(t,e,o){"undefined"==typeof this.node.markup&&(this.node.markup=[]),this.position.markup.set(t,e,o),this.node.markup.push(this.position.markup.get(t,e,"type"))},S.prototype.removeStone=function(t,e){var o=!1;if("undefined"!=typeof this.node.setup)for(var i=0;i<this.node.setup.length;i++)if(t===this.node.setup[i].x&&e===this.node.setup[i].y){this.node.setup.splice(i,1),this.position.stones.unset(t,e),o=!0;break}o||this.addStone(t,e,r.EMPTY)},S.prototype.removeMarkup=function(t,e){if("undefined"!=typeof this.node.markup)for(var o=0;o<this.node.markup.length;o++)if(t===this.node.markup[o].x&&e===this.node.markup[o].y){this.node.markup.splice(o,1),this.position.markup.unset(t,e);break}},S.prototype.hasStone=function(t,e,o){return"undefined"!=typeof o?this.position.stones.is(t,e,o):this.position.stones.has(t,e)},S.prototype.hasMarkup=function(t,e,o){return"undefined"!=typeof o?this.position.markup.is(t,e,o):this.position.markup.has(t,e)},S.prototype.getStone=function(t,e){return this.position.stones.get(t,e)},S.prototype.getMarkup=function(t,e){return this.position.markup.get(t,e)},S.prototype.play=function(t,e,o){o=o||this.position.getTurn();var i=this.validateMove(t,e,o);y.call(this,i);var r=new a({move:{x:t,y:e,color:o}}),s=r.appendTo(this.node);return this.node.rememberedPath=s,this.node=r,this.path.advance(s),!0},S.prototype.pass=function(t){t=t||this.position.getTurn();var e=this.position.clone();e.setTurn(-t),y.call(this,e);var o=new a({move:{pass:!0,color:t}}),i=o.appendTo(this.node);this.node.rememberedPath=i,this.node=o,this.path.advance(i)},S.prototype.next=function(t){if("object"==typeof t&&(t=this.node.children.indexOf(t)),f.call(this,t))try{return w.call(this),!0}catch(e){throw p.call(this),e}return!1},S.prototype.previous=function(){return p.call(this)?(v.call(this),!0):!1},S.prototype.last=function(){for(;f.call(this);)try{w.call(this)}catch(t){throw p.call(this),t}},S.prototype.first=function(){g.call(this),m.call(this),w.call(this)},S.prototype["goto"]=function(t){if(null!==this.root&&"undefined"!=typeof t){"function"==typeof t&&(t=t.call(this));var e;if("number"==typeof t)e=this.path.clone(),e.setMove(t);else if("string"==typeof t){if(this.node.name===t)return;if(e=this.getPathToNode(t),null===e)return}else e=t;if(!this.path.compare(e)){g.call(this),m.call(this),y.call(this),w.call(this);for(var o=e.getMove(),i=0;o>i&&f.call(this,e.nodeAt(i));i++)try{w.call(this)}catch(r){throw p.call(this),r}}}},S.prototype.nextFork=function(){for(;f.call(this);){try{w.call(this)}catch(t){throw p.call(this),t}if(this.node.children.length>1)break}},S.prototype.previousFork=function(){for(;p.call(this)&&(v.call(this),!(this.node.children.length>1)););},S.prototype.nextComment=function(){for(;f.call(this);){try{w.call(this)}catch(t){throw p.call(this),t}if(this.node.hasComments())break}},S.prototype.previousComment=function(){for(;p.call(this)&&(v.call(this),!this.node.hasComments()););},S.prototype.getState=function(){if(!this.jgf||!this.path)return null;
var t={jgf:this.jgf,path:this.path.clone()};return t},S.prototype.restoreState=function(t){t&&t.jgf&&t.path&&(this.load(t.jgf),this["goto"](t.path))},S}]})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Node.Service",["ngGo"]).factory("GameNode",["StoneColor",function(t){var o="a".charCodeAt(0),i=function(t){return[t.charCodeAt(0)-o,t.charCodeAt(1)-o]},r=function(t,e){return e=e||{},""===t||"pass"===t?e.pass=!0:("string"==typeof t&&(t=i(t)),e.x=1*t[0],e.y=1*t[1]),e},s=function(e){return e===t.B?"B":e===t.W?"W":""},a=function(e){return"B"===e?t.B:"W"===e?t.W:t.E},n=function(t){var o=e.copy(t),i=s(t.color);return""===i?null:(t.pass===!0?o[i]="pass":o[i]=[t.x,t.y],delete o.x,delete o.y,delete o.color,o)},h=function(t){var e,o;return t.W?(e="W",o=t.W):t.B&&(e="B",o=t.B),o?r(o,{color:a(e)}):null},l=function(t){var e,o,i={};for(e in t)t.hasOwnProperty(e)&&(o=s(t[e].color)||"E","undefined"==typeof i[o]&&(i[o]=[]),i[o].push([t[e].x,t[e].y]));return i},c=function(t){var e,o,i,s=[];for(o in t)if(t.hasOwnProperty(o)){i=a(o);for(e in t[o])t[o].hasOwnProperty(e)&&s.push(r(t[o][e],{color:i}))}return s},d=function(t){var e,o,i={};for(e in t)t.hasOwnProperty(e)&&(o=t[e].type,"undefined"==typeof i[o]&&(i[o]=[]),"label"===o?i[o].push([t[e].x,t[e].y,t[e].text]):i[o].push([t[e].x,t[e].y]));return i},u=function(t){var o,s,a=[];for(s in t)if(t.hasOwnProperty(s))if("label"===s){for(o=0;o<t[s].length;o++)if(e.isArray(t[s][o])){if(2===t[s][o].length&&"string"==typeof t[s][o][0]){var n=t[s][o][1];t[s][o]=i(t[s][o][0]),t[s][o].push(n)}t[s][o].length<3||a.push(r(t[s][o],{type:s,text:t[s][o][2]}))}}else for(o in t[s])t[s].hasOwnProperty(o)&&a.push(r(t[s][o],{type:s}));return a},f=function(e){switch(e){case t.W:return"W";case t.B:return"B";default:return""}},p=function(e){switch(e){case"W":return t.W;case"B":return t.B;default:return t.EMPTY}},g={toJgf:{move:n,setup:l,markup:d,turn:f},fromJgf:{move:h,setup:c,markup:u,turn:p}},m=function(t,e){if(this.parent=e||null,this.children=[],t)for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o])};return m.prototype.getChild=function(t){return t=t||0,this.children[t]?this.children[t]:null},m.prototype.getChildren=function(){return this.children},m.prototype.hasChildren=function(){return this.children.length>0},m.prototype.getParent=function(){return this.parent},m.prototype.hasMoveVariations=function(){if(this.children.length<=1)return!1;for(var t=0,e=0;e<this.children.length;e++)if(this.children[e].isMove()&&t++,t>1)return!0;return!1},m.prototype.getMoveVariations=function(){if(0===this.children.length)return!1;for(var t=[],e=0;e<this.children.length;e++)this.children[e].isMove()&&t.push(this.children[e]);return t},m.prototype.getMoveVariation=function(t,e){for(var o=0;o<this.children.length;o++)if(this.children[o].move&&this.children[o].move.x===t&&this.children[o].move.y===e)return o;return-1},m.prototype.isMoveVariation=function(t,e){for(var o=0;o<this.children.length;o++)if(this.children[o].move&&this.children[o].move.x===t&&this.children[o].move.y===e)return!0;return!1},m.prototype.hasComments=function(){return this.comments&&this.comments.length>0},m.prototype.isMove=function(){return!!this.move},m.prototype.getMoveNumber=function(){return this.isMove()?this.parent?this.parent.getMoveNumber()+1:1:this.parent?this.parent.getMoveNumber():0},m.prototype.remove=function(){if(this.parent){var t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1),this.parent=null}},m.prototype.moveUp=function(){if(this.parent){var t=this.parent.children.indexOf(this);if(t>0){var e=this.parent.children[t-1];this.parent.children[t-1]=this,this.parent.children[t]=e}}},m.prototype.moveDown=function(){if(this.parent){var t=this.parent.children.indexOf(this);if(-1!==t&&t<this.parent.children.length-1){var e=this.parent.children[t+1];this.parent.children[t+1]=this,this.parent.children[t]=e}}},m.prototype.appendTo=function(t){return this.remove(),this.parent=t,t.children.push(this),t.children.length-1},m.prototype.appendChild=function(t){return t.parent=this,this.children.push(t),this.children.length-1},m.prototype.insertNode=function(t){for(var e=0;e<this.children.length;e++)this.children[e].parent=t;t.children=t.children.concat(this.children),t.parent=this,this.children=[t]},m.prototype.fromJgf=function(t,o){if("undefined"!=typeof t.tree)return m.fromJgf(t.tree,o);var i,r,s,a;for(o=o||this,s=0;s<t.length;s++){if(e.isArray(t[s]))for(a=0;a<t[s].length;a++)i=new m,i.fromJgf(t[s][a]),o.appendChild(i);else{var n=Object.getOwnPropertyNames(t[s]);for(var h in n)if(n.hasOwnProperty(h)){var l=n[h];"undefined"!=typeof g.fromJgf[l]?o[l]=g.fromJgf[l](t[s][l]):"object"==typeof t[s][l]?o[l]=e.copy(t[s][l]):o[l]=t[s][l]}}s+1<t.length&&!e.isArray(t[s+1])&&(r=new m,o.appendChild(r),o=r)}},m.prototype.toJgf=function(t){t=t||[];var o={},i=Object.getOwnPropertyNames(this);for(var r in i)if(i.hasOwnProperty(r)){var s=i[r];if("parent"===s||"children"===s)continue;"undefined"!=typeof g.toJgf[s]?o[s]=g.toJgf[s](this[s]):"object"==typeof this[s]?o[s]=e.copy(this[s]):o[s]=this[s]}if(t.push(o),this.children.length>1){var a=[];t.push(a);for(var n=0;n<this.children.length;n++){var h=[];a.push(h),this.children[n].toJgf(h)}}else 1===this.children.length&&this.children[0].toJgf(t);return t},m}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Path.Service",["ngGo"]).factory("GamePath",function(){var t=function(){this.reset()};t.prototype.reset=function(){return this.move=0,this.path={},this.branches=0,this},t.prototype.advance=function(t){return t>0&&(this.path[this.move]=1,this.branches++),this.move++,this},t.prototype.retreat=function(){return 0!==this.move?(this.path[this.move]&&(delete this.path[this.move],this.branches--),this.move--,this):void 0},t.prototype.setMove=function(t){if(t<this.move)for(var e in this.path)e>t&&(delete this.path[e],this.branches--);return this.move=t,this},t.prototype.getMove=function(){return this.move},t.prototype.nodeAt=function(t){return"undefined"==typeof this.path[t]?0:this.path[t]},t.prototype.compare=function(t){if(t&&"object"==typeof t&&"undefined"!=typeof t.move){if(this.move!==t.move||this.branches!==t.branches)return!1;for(var e in this.path)if("undefined"==typeof t.path[e]||this.path[e]!==t.path[e])return!1;return!0}},t.prototype.clone=function(){var o=new t;return o.move=this.move,o.branches=this.branches,o.path=e.copy(this.path),o};var o=function(t,e,i){if(t.name&&t.name===e)return!0;for(var r=0;r<t.children.length;r++){if(i.advance(r),o(t.children[r],e,i))return!0;i.retreat()}return!1};return t.findNode=function(e,i){var r=new t;return o(i,e,r)?r:null},t})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Position.Service",["ngGo","ngGo.Board.Grid.Service"]).factory("GamePosition",["StoneColor","BoardGrid",function(t,e){var o=function(o,i){this.error=0,this.width=0,this.height=0,this.stones=new e,this.markup=new e,this.turn=t.B,this.captures={},this.captures[t.B]=[],this.captures[t.W]=[],this.stones.whenEmpty(t.EMPTY),(o||i)&&this.setSize(o,i)};return o.prototype.setSize=function(t,e){t=t||e||0,e=e||t||0,this.width=parseInt(t),this.height=parseInt(e),this.stones.setSize(t,e),this.markup.setSize(t,e),this.empty()},o.prototype.empty=function(){this.stones.empty(),this.markup.empty()},o.prototype.setStone=function(t,e,o){this.stones.set(t,e,o)},o.prototype.setMarkup=function(t,e,o){this.markup.set(t,e,o)},o.prototype.hasLiberties=function(o,i,r,s){if(!this.stones.isOnGrid(o,i))return!1;s=s||new e(this.width,this.height);var a=this.stones.get(o,i);return r=r||a,s.get(o,i)===!0||a===-r?!1:a===t.EMPTY?!0:(s.set(o,i,!0),this.hasLiberties(o,i-1,r,s)||this.hasLiberties(o,i+1,r,s)||this.hasLiberties(o-1,i,r,s)||this.hasLiberties(o+1,i,r,s))},o.prototype.captureAdjacent=function(e,o,i){if(!this.stones.isOnGrid(e,o))return!1;if(i=i||this.stones.get(e,o),i===t.EMPTY)return!1;var r=!1;return this.canCapture(e,o-1,-i,!0)&&(r=!0),this.canCapture(e,o+1,-i,!0)&&(r=!0),this.canCapture(e-1,o,-i,!0)&&(r=!0),this.canCapture(e+1,o,-i,!0)&&(r=!0),r},o.prototype.canCapture=function(e,o,i,r){return this.stones.isOnGrid(e,o)?this.stones.get(e,o)===t.EMPTY?!1:(i=i||this.stones.get(e,o),this.stones.get(e,o)!==i?!1:this.hasLiberties(e,o,i)?!1:(r&&this.captureGroup(e,o,i),!0)):!1},o.prototype.captureGroup=function(t,e,o){return this.stones.isOnGrid(t,e)?(o=o||this.stones.get(t,e),this.stones.get(t,e)!==o?!1:(this.captureStone(t,e),this.captureGroup(t,e-1,o),this.captureGroup(t,e+1,o),this.captureGroup(t-1,e,o),this.captureGroup(t+1,e,o),!0)):!1},o.prototype.captureStone=function(e,o){if(this.stones.isOnGrid(e,o)){var i=this.stones.get(e,o);i!==t.EMPTY&&(this.stones.set(e,o,t.EMPTY),this.captures[i].push({x:e,y:o}))}},o.prototype.setCaptures=function(t,e){this.captures[t]=e},o.prototype.getCaptures=function(t){return this.captures[t]||[]},o.prototype.getCaptureCount=function(t){return this.captures[-t].length},o.prototype.setTurn=function(t){this.turn=t},o.prototype.getTurn=function(){return this.turn},o.prototype.switchTurn=function(){this.turn=-this.turn},o.prototype.clone=function(){var t=new o;return t.turn=this.turn,t.width=this.width,t.height=this.height,t.stones=this.stones.clone(),t.markup=new e(this.width,this.height),t},o.prototype.isSameAs=function(t){return this.width!==t.width||this.height!==t.height?!1:this.stones.isSameAs(t.stones)},o}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Score.Service",["ngGo"]).factory("GameScore",["StoneColor",function(t){var e=function(){return parseInt(this.stones)+parseInt(this.territory)+parseInt(this.captures)+parseInt(this.komi)},o=function(){var t=this;this.black={},this.white={},this.reset(),this.black.total=function(){return e.call(t.black)},this.white.total=function(){return e.call(t.white)}};return o.prototype.reset=function(){for(var t=["stones","territory","captures","komi"],e=0;e<t.length;e++)this.black[t[e]]=0,this.white[t[e]]=0},o.prototype.winner=function(){var e=this.black.total(),o=this.white.total();return o>e?t.W:e>o?t.B:t.E},o}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Game.Scorer.Service",["ngGo","ngGo.Game.Score.Service","ngGo.Board.Grid.Service"]).factory("GameScorer",["GameScore","StoneColor","BoardGrid",function(t,e,o){var i={UNKNOWN:e.EMPTY,BLACK_STONE:e.B,WHITE_STONE:e.W,BLACK_CANDIDATE:2*e.B,WHITE_CANDIDATE:2*e.W,NEUTRAL:3*e.B},r=function(t,e,o,i){var s=this.stones.get(t,e),a=this.game.position.stones.get(t,e);this.stones.isOnGrid(t,e)&&s!==o&&s!==i&&(2*a===o?this.stones.set(t,e,a):this.stones.set(t,e,o),r.call(this,t-1,e,o,i),r.call(this,t,e-1,o,i),r.call(this,t+1,e,o,i),r.call(this,t,e+1,o,i))},s=function(t,e){var o=this.game.position.stones.get(t,e);this.stones.isOnGrid(t,e)&&this.stones.get(t,e)!==o&&(this.stones.set(t,e,o),s.call(this,t-1,e),s.call(this,t,e-1),s.call(this,t+1,e),s.call(this,t,e+1))},a=function(){for(var t,e,o,r,s,a,n,h,l=!0;l;)for(l=!1,n=0;n<this.stones.width;n++)for(h=0;h<this.stones.height;h++)if(t=this.stones.get(n,h),t===i.UNKNOWN||t===i.BLACK_CANDIDATE||t===i.WHITE_CANDIDATE){for(o=[this.stones.get(n-1,h),this.stones.get(n,h-1),this.stones.get(n+1,h),this.stones.get(n,h+1)],r=s=!1,a=0;4>a;a++)o[a]===i.BLACK_STONE||o[a]===i.BLACK_CANDIDATE?r=!0:o[a]===i.WHITE_STONE||o[a]===i.WHITE_CANDIDATE?s=!0:o[a]===i.NEUTRAL&&(r=s=!0);e=r&&s?i.NEUTRAL:r?i.BLACK_CANDIDATE:s?i.WHITE_CANDIDATE:!1,e!==!1&&e!==t&&(l=!0,this.stones.set(n,h,e))}},n={game:null,score:null,stones:null,captures:null,points:null,load:function(e){this.score=new t,this.game=e,this.stones=this.game.position.stones.clone(),this.captures=new o(this.stones.width,this.stones.height,this.stones.emptyValue),this.points=new o(this.stones.width,this.stones.height,this.stones.emptyValue)},getScore:function(){return this.score},getPoints:function(){return this.points},getCaptures:function(){return this.captures},calculate:function(){if(!this.game)return void console.warn("No game loaded in game scorer, can't calutlate score.");this.points.empty(),this.captures.empty(),a.call(this);var t=this.game.get("game.komi"),o=this.game.getCaptureCount();this.score.reset(),this.score.black.captures=o[e.B],this.score.white.captures=o[e.W],this.score.black.komi=0>t?t:0,this.score.white.komi=t>0?t:0;var r,s,n,h;for(r=0;r<this.stones.width;r++)for(s=0;s<this.stones.height;s++)n=this.stones.get(r,s),h=this.game.position.stones.get(r,s),n!==i.BLACK_STONE||h!==e.B?n!==i.WHITE_STONE||h!==e.W?n!==i.BLACK_CANDIDATE?n!==i.WHITE_CANDIDATE||(this.score.white.territory++,this.points.set(r,s,e.W),h===e.B&&(this.score.white.captures++,this.captures.set(r,s,e.B))):(this.score.black.territory++,this.points.set(r,s,e.B),h===e.W&&(this.score.black.captures++,this.captures.set(r,s,e.W))):this.score.white.stones++:this.score.black.stones++},mark:function(t,o){var a=this.game.position.stones.get(t,o),n=this.stones.get(t,o);a===e.W?n===i.WHITE_STONE?r.call(this,t,o,i.BLACK_CANDIDATE,i.BLACK_STONE):s.call(this,t,o):a===e.B&&(n===i.BLACK_STONE?r.call(this,t,o,i.WHITE_CANDIDATE,i.WHITE_STONE):s.call(this,t,o))}};return n}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Kifu.Blank.Service",["ngGo"]).factory("KifuBlank",["ngGo",function(t){var o={record:{application:t.name+" v"+t.version,version:1,charset:"UTF-8"},game:{type:"go",players:[{color:"black",name:"Black"},{color:"white",name:"White"}]},board:{width:19,height:19},tree:[]},i={AP:t.name+":"+t.version,CA:"UTF-8",FF:"4",GM:"1",SZ:"19",PB:"Black",PW:"White"},r={jgf:function(t){var i=e.copy(o);if(t)for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.extend(i[r]||{},t[r]));return i},sgf:function(t){var o=e.copy(i);if(t)for(var r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return o}};return r}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Kifu.Parser.Service",["ngGo","ngGo.Kifu.Parsers.Gib2Jgf.Service","ngGo.Kifu.Parsers.Sgf2Jgf.Service","ngGo.Kifu.Parsers.Jgf2Sgf.Service"]).constant("sgfAliases",{AP:"record.application",CA:"record.charset",CP:"record.copyright",SO:"record.source",US:"record.transcriber",AN:"record.annotator",GM:"game.type",GN:"game.name",KM:"game.komi",HA:"game.handicap",RE:"game.result",RU:"game.rules",TM:"game.time.main",OT:"game.time.overtime",DT:"game.dates",PC:"game.location",EV:"game.event",RO:"game.round",ON:"game.opening",GC:"game.comment",PB:"name",PW:"name",BT:"team",WT:"team",BR:"rank",WR:"rank",N:"name",C:"comments",CR:"circle",TR:"triangle",SQ:"square",MA:"mark",SL:"select",LB:"label"}).constant("sgfGames",{1:"go",2:"othello",3:"chess",4:"renju",6:"backgammon",7:"chinese chess",8:"shogi"}).factory("KifuParser",["Gib2Jgf","Sgf2Jgf","Jgf2Sgf",function(t,e,o){var i={gib2jgf:function(e,o){return t.parse(e,o)},sgf2jgf:function(t,o){return e.parse(t,o)},jgf2sgf:function(t){return o.parse(t)}};return i}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Directive",["ngGo.Board.Directive"]).directive("player",["Player",function(t){return{restrict:"E",controller:["$scope",function(e){e.Player||(e.Player=t)}],link:function(e,o,i){t.linkElement(o),i.$observe("mode",function(e){t.switchMode(e)}),i.$observe("tool",function(e){t.switchTool(e)}),i.$observe("variationMarkup",function(e){t.setVariationMarkup("true"===e)}),i.$observe("solutionPaths",function(e){t.toggleSolutionPaths("true"===e)}),i.$observe("lastMoveMarker",function(e){t.setLastMoveMarker(e)})}}}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Service",["ngGo","ngGo.Player.Directive","ngGo.Player.Mode.Common.Service","ngGo.Board.Service","ngGo.Game.Service","ngGo.Game.Scorer.Service"]).provider("Player",["PlayerModes","PlayerTools","MarkupTypes",function(o,i,r){var s={mode:o.REPLAY,tool:i.MOVE,arrowKeysNavigation:!0,scrollWheelNavigation:!0,lastMoveMarker:r.LAST,variationMarkup:!0,variationChildren:!0,variationSiblings:!1};this.setConfig=function(t){s=e.extend(s,t)},this.$get=["$rootScope","$document","Game","GameScorer","Board","PlayerTools",function(o,i,a,n,h,l){var c=function(e,o){if(!this.board||!o)return e.x=-1,void(e.y=-1);var i=0,r=0;"undefined"!=typeof o.offsetX?i=o.offsetX:o.originalEvent&&"undefined"!=typeof o.originalEvent.offsetX?i=o.originalEvent.offsetX:o.originalEvent&&"undefined"!=typeof o.originalEvent.layerX&&(i=o.originalEvent.layerX),"undefined"!=typeof o.offsetY?r=o.offsetY:o.originalEvent&&"undefined"!=typeof o.originalEvent.offsetY?r=o.originalEvent.offsetY:o.originalEvent&&"undefined"!=typeof o.originalEvent.layerY&&(r=o.originalEvent.layerY),i*=t.devicePixelRatio||1,r*=t.devicePixelRatio||1,e.x=this.board.getGridX(i),e.y=this.board.getGridY(r),o.drag&&(e.drag=o.drag)},d={config:{},board:null,game:null,modes:{},tools:[],mode:"",tool:"",path:null,init:function(){this.board=null,this.game=new a,this.path=null,this.mode="",this.tool="",this.arrowKeysNavigation=!1,this.scrollWheelNavigation=!1,this.lastMoveMarker="",this.variationMarkup=!1,this.variationChildren=!1,this.variationSiblings=!1,this.restrictNodeStart=null,this.restrictNodeEnd=null,this.parseConfig()},linkElement:function(t){this.element=t,this.registerElementEvent("keydown",i),this.registerElementEvent("click"),this.registerElementEvent("mousedown"),this.registerElementEvent("mouseup"),this.registerElementEvent("mousemove"),this.registerElementEvent("mouseout"),this.registerElementEvent("mousewheel"),this.registerElementEvent("wheel")},parseConfig:function(t){this.config=e.extend({},s,t||{}),this.switchMode(this.config.mode),this.switchTool(this.config.tool),this.setArrowKeysNavigation(this.config.arrowKeysNavigation),this.setScrollWheelNavigation(this.config.scrollWheelNavigation),this.setLastMoveMarker(this.config.lastMoveMarker),this.setVariationMarkup(this.config.variationMarkup,this.config.variationChildren,this.config.variationSiblings);for(var o in this.modes)this.modes[o].parseConfig&&this.modes[o].parseConfig.call(this,this.config)},setArrowKeysNavigation:function(t){t!==this.arrowKeysNavigation&&(this.arrowKeysNavigation=t,this.broadcast("settingChange","arrowKeysNavigation"))},setScrollWheelNavigation:function(t){t!==this.scrollWheelNavigation&&(this.scrollWheelNavigation=t,this.broadcast("settingChange","scrollWheelNavigation"))},setLastMoveMarker:function(t){t!==this.lastMoveMarker&&(this.lastMoveMarker=t,this.broadcast("settingChange","lastMoveMarker"))},setVariationMarkup:function(t,e,o){var i=!1;t!==this.variationMarkup&&(this.variationMarkup=t,i=!0),"undefined"!=typeof e&&e!==this.variationChildren&&(this.variationChildren=e,i=!0),"undefined"!=typeof o&&o!==this.variationSiblings&&(this.variationSiblings=o,i=!0),i&&this.broadcast("settingChange","variationMarkup")},registerMode:function(t,e){this.modes[t]=e,this.modes[t].parseConfig&&this.modes[t].parseConfig.call(this,this.config),this.mode===t&&(this.switchMode(this.mode,!0),this.switchTool(this.tool,!0))},setTools:function(t){this.tools=t||[l.NONE]},hasMode:function(t){return this.modes[t]?!0:!1},hasTool:function(t){return-1!==this.tools.indexOf(t)},switchMode:function(t,e){return e||t&&this.mode!==t?(this.mode&&this.broadcast("modeExit",this.mode),this.mode=t,this.tools=[],this.tool=l.NONE,this.broadcast("modeEnter",this.mode),!0):!1},switchTool:function(t,e){return e||t&&this.tool!==t?this.mode&&this.modes[this.mode]&&-1===this.tools.indexOf(t)?!1:(this.tool=t,this.broadcast("toolSwitch",this.tool),!0):!1},saveState:function(){this.playerState={mode:this.mode,tool:this.tool,restrictNodeStart:this.restrictNodeStart,restrictNodeEnd:this.restrictNodeEnd},this.saveGameState()},restoreState:function(){this.playerState&&(this.switchMode(this.playerState.mode),this.switchTool(this.playerState.tool),this.restrictNodeStart=this.playerState.restrictNodeStart,this.restrictNodeEnd=this.playerState.restrictNodeEnd,this.restoreGameState())},load:function(t,e){try{this.game.load(t)}catch(o){throw o}return this.path=null,(e||"undefined"==typeof e)&&this.parseConfig(this.game.get("settings")),this.broadcast("gameLoaded",this.game),this.board&&(this.board.removeAll(),this.board.parseConfig(this.game.get("board")),this.processPosition()),!0},reload:function(){this.game&&this.game.isLoaded()&&(this.game.reload(),this.board&&(this.board.removeAll(),this.processPosition()))},saveGameState:function(){this.game&&this.game.isLoaded()&&(this.gameState=this.game.getState())},restoreGameState:function(){this.game&&this.gameState&&(this.game.restoreState(this.gameState),this.board&&(this.board.removeAll(),this.processPosition()))},next:function(t){this.game&&this.game.node!==this.restrictNodeEnd&&(this.game.next(t),this.processPosition())},previous:function(){this.game&&this.game.node!==this.restrictNodeStart&&(this.game.previous(),this.processPosition())},last:function(){this.game&&(this.game.last(),this.processPosition())},first:function(){this.game&&(this.game.first(),this.processPosition())},"goto":function(t){this.game&&t&&(this.game["goto"](t),this.processPosition())},previousFork:function(){this.game&&(this.game.previousFork(),this.processPosition())},nextFork:function(){this.game&&(this.game.nextFork(),this.processPosition())},nextComment:function(){this.game&&this.game.node!==this.restrictNodeEnd&&(this.game.nextComment(),this.processPosition())},previousComment:function(){this.game&&this.game.node!==this.restrictNodeStart&&(this.game.previousComment(),this.processPosition())},restrictNode:function(t){this.game&&this.game.node&&(t?this.restrictNodeEnd=this.game.node:this.restrictNodeStart=this.game.node)},processPosition:function(){if(this.game&&this.game.isLoaded()){var t=this.game.getNode(),e=this.game.getPath(),o=this.game.getPosition(),i=!e.compare(this.path);this.updateBoard(t,o,i),i&&(this.path=e.clone(),this.broadcast("pathChange",t),t.name&&this.broadcast("reachedNode."+t.name,t)),t.move&&t.move.pass&&this.broadcast("movePassed",t)}},showMoveNumbers:function(t,o){if(this.game&&this.game.isLoaded()){t=t||1,o=o||this.game.getMove();var i=this.game.getMoveNodes(t,o),s=t;e.forEach(i,function(t){this.board.add("markup",t.move.x,t.move.y,{type:r.LABEL,text:s++})},this),this.board.redraw("markup")}},newGame:function(){this.game=new a,this.processPosition()},scoreGame:function(){n.calculate();var t=n.getScore(),e=n.getPoints(),o=n.getCaptures();this.board.layers.markup.removeAll(),this.board.layers.score.setAll(e,o),this.broadcast("scoreCalculated",t)},getBoard:function(){return this.board},setBoard:function(t){this.board=t,this.board&&this.broadcast("boardReady",this.board),this.game&&this.game.isLoaded()&&(this.board.removeAll(),this.board.parseConfig(this.game.get("board")),this.processPosition())},updateBoard:function(t,e,o){this.board&&(this.board.updatePosition(e,o),this.lastMoveMarker&&t.move&&!t.move.pass&&this.board.add("markup",t.move.x,t.move.y,this.lastMoveMarker),this.broadcast("boardUpdate",t))},registerElementEvent:function(t,e){"undefined"!=typeof e&&e.on||(e=this.element),e.off(t),e.on(t,this.broadcast.bind(this,t))},on:function(t,e,r,s){if("function"!=typeof e)return void console.warn("Listener is not a function:",e);r&&r.$parent&&(s=r,r="");{if(-1===t.indexOf(" ")){var a=this,n=s||o;return n.$on("ngGo.player."+t,function(){if(!(r&&("string"==typeof r&&r!==a.mode||-1===r.indexOf(a.mode))||"keydown"===t&&i[0].querySelector(":focus"))){if(("click"===t||"hover"===t||"mouse"===t.substr(0,5))&&c.call(a,arguments[0],arguments[1]),a.preventClickEvent&&"click"===t)return void delete a.preventClickEvent;"mousedrag"===t&&(a.preventClickEvent=!0),e.apply(a,arguments)}})}for(var h=t.split(" "),l=0;l<h.length;l++)this.on(h[l],e,r,s)}},broadcast:function(t,e){t&&(o.$$phase?o.$broadcast("ngGo.player."+t,e):o.$apply(function(){o.$broadcast("ngGo.player."+t,e)}))}};return d.init(),d}]}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.GridLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.Coordinates.Service"]).factory("GridLayer",["BoardLayer","Coordinates",function(t,o){var i=function(t,e,o,i){if(!(t<this.board.grid.xLeft||t>this.board.grid.xRight||e<this.board.grid.yTop||e>this.board.grid.yBot)){var r=this.board.getAbsX(t),s=this.board.getAbsY(e);this.context.beginPath(),this.context.fillStyle=i,this.context.arc(r,s,o,0,2*Math.PI,!0),this.context.fill()}},r=function(e,o){this.coordinates=!1,t.call(this,e,o)};return e.extend(r.prototype,t.prototype),r.prototype.setCoordinates=function(t){this.coordinates=t},r.prototype.getAll=function(){return null},r.prototype.setAll=function(){},r.prototype.removeAll=function(){},r.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight){var t=this.board.drawMarginHor,e=this.board.drawMarginVer,r=this.board.getCellSize(),s=this.board.theme.get("grid.lineWidth",r),a=this.board.theme.get("grid.lineCap"),n=this.board.theme.get("grid.lineColor"),h=this.board.theme.get("grid.star.radius",r),l=this.board.theme.get("grid.star.color"),c=this.board.theme.get("grid.star.points",this.board.width,this.board.height),d=this.board.theme.canvasTranslate(s);this.context.translate(d,d),this.context.beginPath(),this.context.lineWidth=s,this.context.lineCap=a,this.context.strokeStyle=n;var u,f,p;for(u=this.board.grid.xLeft;u<=this.board.grid.xRight;u++)f=this.board.getAbsX(u),this.context.moveTo(f,e),this.context.lineTo(f,e+this.board.gridDrawHeight);for(u=this.board.grid.yTop;u<=this.board.grid.yBot;u++)p=this.board.getAbsY(u),this.context.moveTo(t,p),this.context.lineTo(t+this.board.gridDrawWidth,p);for(this.context.stroke(),u=0;u<c.length;u++)i.call(this,c[u].x,c[u].y,h,l);this.context.translate(-d,-d),this.coordinates&&o.draw.call(this)}},r.prototype.clearCell=function(t,e){var o=this.board.getAbsX(t),i=this.board.getAbsY(e),r=this.board.getCellSize(),s=this.board.theme.get("stone.radius",r),a=this.board.theme.get("grid.lineWidth",r),n=this.board.theme.canvasTranslate(a);this.context.translate(n,n),this.context.clearRect(o-s,i-s,2*s,2*s),this.context.translate(-n,-n)},r.prototype.redrawCell=function(t,e){var o=this.board.getAbsX(t),r=this.board.getAbsY(e),s=this.board.getCellSize(),a=this.board.theme.get("stone.radius",s),n=this.board.theme.get("grid.lineWidth",s),h=this.board.theme.get("grid.lineColor"),l=this.board.theme.get("grid.star.radius",s),c=this.board.theme.get("grid.star.color"),d=this.board.theme.canvasTranslate(n),u=this.board.theme.get("grid.star.points",this.board.width,this.board.height),f=0===t?o:o-a,p=t===this.board.width-1?o:o+a,g=0===e?r:r-a,m=e===this.board.height-1?r:r+a;this.context.translate(d,d),this.context.beginPath(),this.context.lineWidth=n,this.context.strokeStyle=h,this.context.moveTo(f,r),this.context.lineTo(p,r),this.context.moveTo(o,g),this.context.lineTo(o,m),this.context.stroke();for(var y in u)u[y].x===t&&u[y].y===e&&i.call(this,t,e,l,c);this.context.translate(-d,-d)},r}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.HoverLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.Markup.Service","ngGo.Board.Object.StoneFaded.Service"]).factory("HoverLayer",["BoardLayer","Markup","StoneFaded",function(t,o,i){var r=function(e,o){this.restore=[],t.call(this,e,o)};return e.extend(r.prototype,t.prototype),r.prototype.add=function(t,r,s){if(this.grid.isOnGrid(t,r)){if(this.remove(t,r),s.object={x:t,y:r},"stones"===s.type)s.objectClass=i,s.object.color=s.value;else{if("markup"!==s.type)return void console.warn("Unknown hover type",s.type);s.objectClass=o,"object"==typeof s.value?s.object=e.extend(s.object,s.value):s.object.type=s.value}this.board.has(s.type,t,r)&&(this.restore.push({x:t,y:r,layer:s.type,value:this.board.get(s.type,t,r)}),this.board.remove(s.type,t,r)),this.grid.set(t,r,s),s.objectClass&&s.objectClass.draw&&s.objectClass.draw.call(this,s.object)}},r.prototype.remove=function(t,e){if(this.grid.has(t,e)){var o=this.grid.get(t,e);o.objectClass&&o.objectClass.clear&&o.objectClass.clear.call(this,o.object);for(var i=0;i<this.restore.length;i++)this.restore[i].x===t&&this.restore[i].y===e&&(this.board.add(this.restore[i].layer,this.restore[i].x,this.restore[i].y,this.restore[i].value),this.restore.splice(i,1))}},r.prototype.removeAll=function(){if(!this.grid.isEmpty()){var t,e=this.grid.all("layer");for(t=0;t<e.length;t++)e[t].objectClass&&e[t].objectClass.clear&&e[t].objectClass.clear.call(this,e[t].object);for(this.clear(),this.grid.empty(),t=0;t<this.restore.length;t++)this.board.add(this.restore[t].layer,this.restore[t].x,this.restore[t].y,this.restore[t].value);this.restore=[]}},r.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight)for(var t=this.grid.all("hover"),e=0;e<t.length;e++)t.objectClass&&t.objectClass.draw&&t.objectClass.draw.call(this,t.object)},r}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.MarkupLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.Markup.Service"]).factory("MarkupLayer",["BoardLayer","Markup",function(t,o){var i=function(e,o){t.call(this,e,o)};return e.extend(i.prototype,t.prototype),i.prototype.setAll=function(t){var e,i=this.grid.compare(t,"type");for(e=0;e<i.remove.length;e++)o.clear.call(this,i.remove[e]);for(e=0;e<i.add.length;e++)o.draw.call(this,i.add[e]);this.grid=t.clone()},i.prototype.removeAll=function(){for(var t=this.grid.all("type"),e=0;e<t.length;e++)o.clear.call(this,t[e]);this.grid.empty()},i.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight)for(var t=this.grid.all("type"),e=0;e<t.length;e++)o.draw.call(this,t[e])},i.prototype.drawCell=function(t,e){0!==this.board.drawWidth&&0!==this.board.drawheight&&this.grid.has(t,e)&&o.draw.call(this,this.grid.get(t,e,"type"))},i.prototype.clearCell=function(t,e){this.grid.has(t,e)&&o.clear.call(this,this.grid.get(t,e,"type"))},i}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.ScoreLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.StoneMini.Service","ngGo.Board.Object.StoneFaded.Service"]).factory("ScoreLayer",["BoardLayer","StoneMini","StoneFaded",function(t,o,i){var r=function(e,o){this.points=[],this.captures=[],t.call(this,e,o)};return e.extend(r.prototype,t.prototype),r.prototype.setAll=function(t,e){this.removeAll(),this.points=t.all("color"),this.captures=e.all("color"),this.draw()},r.prototype.removeAll=function(){for(var t=0;t<this.captures.length;t++)this.board.add("stones",this.captures[t].x,this.captures[t].y,this.captures[t].color);this.clear(),this.points=[],this.captures=[]},r.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight){var t;for(t=0;t<this.captures.length;t++)this.board.remove("stones",this.captures[t].x,this.captures[t].y),i.draw.call(this,this.captures[t]);for(t=0;t<this.points.length;t++)o.draw.call(this,this.points[t])}},r}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.ShadowLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.StoneShadow.Service"]).factory("ShadowLayer",["BoardLayer","StoneShadow",function(t,o){var i=function(e,o){t.call(this,e,o)};return e.extend(i.prototype,t.prototype),i.prototype.add=function(t){t.shadow===!1||"undefined"!=typeof t.alpha&&t.alpha<1||this.grid.has(t.x,t.y)||(this.grid.set(t.x,t.y,t.color),this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight&&o.draw.call(this,t))},i.prototype.remove=function(t){this.grid.unset(t.x,t.y),this.redraw()},i.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight){var t=this.board.theme.get("shadow.size",this.board.getCellSize());this.context.setTransform(1,0,0,1,t,t);for(var e=this.grid.all("color"),i=0;i<e.length;i++)o.draw.call(this,e[i])}},i}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Layer.StonesLayer.Service",["ngGo","ngGo.Board.Layer.Service","ngGo.Board.Object.Stone.Service"]).factory("StonesLayer",["BoardLayer","Stone","StoneColor",function(t,o,i){var r=function(e,o){
t.call(this,e,o),this.grid.whenEmpty(i.EMPTY)};return e.extend(r.prototype,t.prototype),r.prototype.setAll=function(t){var e,i=this.grid.compare(t,"color");for(e=0;e<i.remove.length;e++)o.clear.call(this,i.remove[e]);for(e=0;e<i.add.length;e++)o.draw.call(this,i.add[e]);this.grid=t.clone()},r.prototype.draw=function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight)for(var t=this.grid.all("color"),e=0;e<t.length;e++)o.draw.call(this,t[e])},r.prototype.redraw=function(){this.board.removeAll("shadow"),this.clear(),this.draw()},r.prototype.drawCell=function(t,e){0!==this.board.drawWidth&&0!==this.board.drawheight&&this.grid.has(t,e)&&o.draw.call(this,this.grid.get(t,e,"color"))},r.prototype.clearCell=function(t,e){this.grid.has(t,e)&&o.clear.call(this,this.grid.get(t,e,"color"))},r}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.Coordinates.Service",["ngGo"]).factory("Coordinates",function(){var t=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e="A".charCodeAt(0),o="a".charCodeAt(0),i={kanji:function(e){return t[e]||""},numbers:function(t){return t+1},letters:function(t){var o="";return t>=25&&(o="A",t-=25),t>=8&&t++,o+String.fromCharCode(e+t)},jgf:function(t){return t},sgf:function(t){var i;return i=26>t?o+t:e+t,String.fromCharCode(i)}},r={draw:function(){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight){var t=this.board.getCellSize(),e=Math.ceil((this.board.drawMarginHor-t/2)/2),o=this.board.drawWidth-e,r=Math.ceil((this.board.drawMarginVer-t/2)/2),s=this.board.drawHeight-r,a=this.board.theme.get("coordinates.color"),n={font:this.board.theme.get("coordinates.vertical.font"),size:this.board.theme.get("coordinates.vertical.size"),style:this.board.theme.get("coordinates.vertical.style"),inverse:this.board.theme.get("coordinates.vertical.inverse")},h={font:this.board.theme.get("coordinates.horizontal.font"),size:this.board.theme.get("coordinates.horizontal.size"),style:this.board.theme.get("coordinates.horizontal.style"),inverse:this.board.theme.get("coordinates.horizontal.inverse")};this.context.fillStyle=a,this.context.textBaseline="middle",this.context.textAlign="center";var l,c,d,u,f;for(l=0;l<this.board.height;l++)c=l,n.inverse&&(c=this.board.height-l-1),f="function"==typeof n.style?n.style.call(this,c):i[n.style]?i[n.style].call(this,c):c,u=this.board.getAbsY(l),this.context.font=n.size(f,t)+" "+n.font,this.context.fillText(f,e,u),this.context.fillText(f,o,u);for(l=0;l<this.board.width;l++)c=l,h.inverse&&(c=this.board.width-l-1),f="function"==typeof h.style?h.style.call(this,c):i[h.style]?i[h.style].call(this,c):c,d=this.board.getAbsX(l),this.context.font=h.size(f,t)+" "+h.font,this.context.fillText(f,d,r),this.context.fillText(f,d,s)}}};return r})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.Markup.Service",["ngGo","ngGo.Board.Object.Service"]).factory("Markup",["MarkupTypes","BoardObject",function(t,e){var o=Math.cos(Math.PI/4),i=Math.cos(Math.PI/6),r=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),r=this.board.getCellSize(),s=Math.round(this.board.theme.get("stone.radius",r)*this.board.theme.get("markup.triangle.scale"));t.scale&&(s=Math.round(s*t.scale));var a=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,n=t.lineWidth||this.board.theme.get("markup.lineWidth",r)||1,h=t.color||this.board.theme.get("markup.color",a),l=this.board.theme.canvasTranslate(n);this.context.translate(l,l),this.context.strokeStyle=h,this.context.lineWidth=n,this.context.beginPath(),this.context.moveTo(e,o-s),this.context.lineTo(e-Math.round(s*i),o+Math.round(s/2)),this.context.lineTo(e+Math.round(s*i),o+Math.round(s/2)),this.context.closePath(),this.context.stroke(),this.context.translate(-l,-l)},s=function(t){var e=this.board.getAbsX(t.x),i=this.board.getAbsY(t.y),r=this.board.getCellSize(),s=Math.round(this.board.theme.get("stone.radius",r)*this.board.theme.get("markup.square.scale"));t.scale&&(s=Math.round(s*t.scale));var a=Math.round(s*o),n=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,h=t.lineWidth||this.board.theme.get("markup.lineWidth",r)||1,l=t.color||this.board.theme.get("markup.color",n),c=this.board.theme.canvasTranslate(h);this.context.translate(c,c),this.context.strokeStyle=l,this.context.lineWidth=h,this.context.beginPath(),this.context.rect(e-a,i-a,2*a,2*a),this.context.stroke(),this.context.translate(-c,-c)},a=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.round(this.board.theme.get("stone.radius",i)*this.board.theme.get("markup.circle.scale"));t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.lineWidth||this.board.theme.get("markup.lineWidth",i)||1,n=t.color||this.board.theme.get("markup.color",s),h=this.board.theme.canvasTranslate();this.context.translate(h,h),this.context.strokeStyle=n,this.context.lineWidth=a,this.context.beginPath(),this.context.arc(e,o,r,0,2*Math.PI,!0),this.context.stroke(),this.context.translate(-h,-h)},n=function(t){var e=this.board.getAbsX(t.x),i=this.board.getAbsY(t.y),r=this.board.getCellSize(),s=Math.round(this.board.theme.get("stone.radius",r)*this.board.theme.get("markup.mark.scale"));t.scale&&(s=Math.round(s*t.scale));var a=Math.round(s*o),n=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,h=t.lineWidth||this.board.theme.get("markup.lineWidth",r)||1,l=t.lineCap||this.board.theme.get("markup.mark.lineCap"),c=t.color||this.board.theme.get("markup.color",n),d=this.board.theme.canvasTranslate(h);this.context.translate(d,d),this.context.strokeStyle=c,this.context.lineWidth=h,this.context.lineCap=l,this.context.beginPath(),this.context.moveTo(e-a,i-a),this.context.lineTo(e+a,i+a),this.context.moveTo(e+a,i-a),this.context.lineTo(e-a,i+a),this.context.stroke(),this.context.translate(-d,-d)},h=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.round(this.board.theme.get("stone.radius",i)*this.board.theme.get("markup.circle.scale"));t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.lineWidth||this.board.theme.get("markup.lineWidth",i)||1,n=t.color||this.board.theme.get("markup.color",s),h=this.board.theme.canvasTranslate();this.context.translate(h,h),this.context.fillStyle=n,this.context.lineWidth=a,this.context.beginPath(),this.context.arc(e,o,r,0,2*Math.PI,!0),this.context.fill(),this.context.translate(-h,-h)},l=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.round(this.board.theme.get("stone.radius",i)*this.board.theme.get("markup.last.scale"));t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.color||this.board.theme.get("markup.color",s),n=this.board.theme.canvasTranslate(i);this.context.translate(n,n),this.context.fillStyle=a,this.context.beginPath(),this.context.moveTo(e,o),this.context.lineTo(e+r,o),this.context.lineTo(e,o+r),this.context.closePath(),this.context.fill(),this.context.translate(-n,-n)},c=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.round(this.board.theme.get("stone.radius",i)*this.board.theme.get("markup.smiley.scale"));t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.lineWidth||this.board.theme.get("markup.lineWidth",i)||1,n=t.lineCap||this.board.theme.get("markup.smiley.lineCap"),h=t.color||this.board.theme.get("markup.color",s),l=this.board.theme.canvasTranslate();this.context.translate(l,l),this.context.strokeStyle=h,this.context.lineWidth=a,this.context.lineCap=n,this.context.beginPath(),this.context.arc(e-r/3,o-r/3,r/6,0,2*Math.PI,!0),this.context.stroke(),this.context.beginPath(),this.context.arc(e+r/3,o-r/3,r/6,0,2*Math.PI,!0),this.context.stroke(),this.context.beginPath(),this.context.moveTo(e-r/1.6,o+r/8),this.context.bezierCurveTo(e-r/1.8,o+r/1.5,e+r/1.8,o+r/1.5,e+r/1.6,o+r/8),this.context.stroke(),this.context.translate(-l,-l)},d=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.round(this.board.theme.get("stone.radius",i)*this.board.theme.get("markup.smiley.scale"));t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.lineWidth||this.board.theme.get("markup.lineWidth",i)||1,n=t.lineCap||this.board.theme.get("markup.smiley.lineCap"),h=t.color||this.board.theme.get("markup.color",s),l=this.board.theme.canvasTranslate();this.context.translate(l,l),this.context.strokeStyle=h,this.context.lineWidth=a,this.context.lineCap=n,this.context.beginPath(),this.context.arc(e-r/3,o-r/3,r/6,0,2*Math.PI,!0),this.context.stroke(),this.context.beginPath(),this.context.arc(e+r/3,o-r/3,r/6,0,2*Math.PI,!0),this.context.stroke(),this.context.beginPath(),this.context.moveTo(e-r/1.6,o+r/1.5-1),this.context.bezierCurveTo(e-r/1.8,o+r/8-1,e+r/1.8,o+r/8-1,e+r/1.6,o+r/1.5-1),this.context.stroke(),this.context.translate(-l,-l)},u=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=this.board.theme.get("stone.radius",i);t.scale&&(r=Math.round(r*t.scale));var s=this.board.get("stones",t.x,t.y)*this.board.colorMultiplier,a=t.font||this.board.theme.get("markup.label.font")||"",n=t.color||this.board.theme.get("markup.color",s),h=this.board.theme.canvasTranslate();this.board.has("stones",t.x,t.y)||this.board.layers.grid.clearCell(t.x,t.y),this.context.translate(h,h),this.context.fillStyle=n,this.context.textBaseline="middle",this.context.textAlign="center","number"==typeof t.text&&(t.text=t.text.toString()),1===t.text.length?this.context.font=Math.round(1.5*r)+"px "+a:2===t.text.length?this.context.font=Math.round(1.2*r)+"px "+a:this.context.font=r+"px "+a,this.context.beginPath(),this.context.fillText(t.text,e,o,2*r),this.context.translate(-h,-h)},f=function(t){this.board.has("stones",t.x,t.y)||this.board.layers.grid.redrawCell(t.x,t.y)},p={draw:function(e){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight)switch(e.type){case t.TRIANGLE:r.call(this,e);break;case t.SQUARE:s.call(this,e);break;case t.CIRCLE:a.call(this,e);break;case t.MARK:n.call(this,e);break;case t.SELECT:h.call(this,e);break;case t.HAPPY:c.call(this,e);break;case t.SAD:d.call(this,e);break;case t.LAST:l.call(this,e);break;case t.LABEL:e.text=e.text||"",u.call(this,e)}},clear:function(o){this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight&&(e.clear.call(this,o),o.type===t.LABEL&&f.call(this,o))}};return p}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.Stone.Service",["ngGo","ngGo.Board.Object.Service","ngGo.Board.ShellPattern.Service"]).factory("Stone",["$injector","BoardObject","StoneColor","ShellPattern",function(t,e,o,i){var r,s=function(t){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=this.board.theme.get("stone.radius",i);t.scale&&(r=Math.round(r*t.scale)),t.shadow=!1;var s=t.color*this.board.colorMultiplier,a=this.board.theme.get("stone.mono.lineWidth",i)||1,n=this.board.theme.get("stone.mono.color",s),h=this.board.theme.get("stone.mono.lineColor",s),l=this.board.theme.canvasTranslate();this.context.translate(l,l),t.alpha&&t.alpha<1&&(this.context.globalAlpha=t.alpha),this.context.fillStyle=n,this.context.beginPath(),this.context.arc(e,o,Math.max(0,r-a),0,2*Math.PI,!0),this.context.fill(),this.context.lineWidth=a,this.context.strokeStyle=h,this.context.stroke(),t.alpha&&t.alpha<1&&(this.context.globalAlpha=1),this.context.translate(-l,-l)},a=function(t){var e=this.board.getAbsX(t.x),i=this.board.getAbsY(t.y),r=this.board.getCellSize(),s=this.board.theme.get("stone.radius",r);t.scale&&(s=Math.round(s*t.scale));var a=t.color*this.board.colorMultiplier,n=this.board.theme.canvasTranslate();this.context.translate(n,n),t.alpha&&t.alpha<1&&(this.context.globalAlpha=t.alpha),this.context.beginPath(),a===o.W?(this.context.fillStyle=this.context.createRadialGradient(e-2*s/5,i-2*s/5,s/3,e-s/5,i-s/5,5*s/5),this.context.fillStyle.addColorStop(0,"#fff"),this.context.fillStyle.addColorStop(1,"#aaa")):(this.context.fillStyle=this.context.createRadialGradient(e-2*s/5,i-2*s/5,1,e-s/5,i-s/5,4*s/5),this.context.fillStyle.addColorStop(0,"#666"),this.context.fillStyle.addColorStop(1,"#111")),this.context.arc(e,i,Math.max(0,s-.5),0,2*Math.PI,!0),this.context.fill(),t.alpha&&t.alpha<1&&(this.context.globalAlpha=1),this.context.translate(-n,-n)},n=function(t){var e=this.board.getAbsX(t.x),s=this.board.getAbsY(t.y),a=this.board.getCellSize(),n=this.board.theme.get("stone.radius",a);t.scale&&(n=Math.round(n*t.scale)),r=r||Math.ceil(9999999*Math.random());var h=t.color*this.board.colorMultiplier,l=this.board.theme.get("stone.shell.types"),c=this.board.theme.get("stone.shell.color",h),d=this.board.theme.get("stone.shell.stroke"),u=this.board.theme.canvasTranslate();if(this.context.translate(u,u),t.alpha&&t.alpha<1&&(this.context.globalAlpha=t.alpha),this.context.beginPath(),this.context.arc(e,s,Math.max(0,n-.5),0,2*Math.PI,!0),this.context.fillStyle=c,this.context.fill(),h===o.W){var f=r%(l.length+t.x*this.board.width+t.y)%l.length,p=this.board.width*this.board.height+t.x*this.board.width+t.y,g=2/p*(r%p);i.call(l[f],this.context,e,s,n,g,d),this.context.beginPath(),this.context.fillStyle=this.context.createRadialGradient(e-2*n/5,s-2*n/5,n/6,e-n/5,s-n/5,n),this.context.fillStyle.addColorStop(0,"rgba(255,255,255,0.9)"),this.context.fillStyle.addColorStop(1,"rgba(255,255,255,0)"),this.context.arc(e,s,Math.max(0,n-.5),0,2*Math.PI,!0),this.context.fill()}else this.context.beginPath(),this.context.fillStyle=this.context.createRadialGradient(e+2*n/5,s+2*n/5,0,e+n/2,s+n/2,n),this.context.fillStyle.addColorStop(0,"rgba(32,32,32,1)"),this.context.fillStyle.addColorStop(1,"rgba(0,0,0,0)"),this.context.arc(e,s,Math.max(0,n-.5),0,2*Math.PI,!0),this.context.fill(),this.context.beginPath(),this.context.fillStyle=this.context.createRadialGradient(e-2*n/5,s-2*n/5,1,e-n/2,s-n/2,3*n/2),this.context.fillStyle.addColorStop(0,"rgba(64,64,64,1)"),this.context.fillStyle.addColorStop(1,"rgba(0,0,0,0)"),this.context.arc(e,s,Math.max(0,n-.5),0,2*Math.PI,!0),this.context.fill();t.alpha&&t.alpha<1&&(this.context.globalAlpha=1),this.context.translate(-u,-u)},h={draw:function(e){if(this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight){var o=this.board.theme.get("stone.style");switch(o){case"shell":n.call(this,e);break;case"glass":a.call(this,e);break;case"mono":s.call(this,e);break;default:var i=t.get(o);i&&i.call(this,e)}!this.board["static"]&&e.shadow!==!1&&this.board.theme.get("stone.shadow")&&this.board.layers.shadow.add(e)}},clear:function(t){this.context&&0!==this.board.drawWidth&&0!==this.board.drawheight&&(e.clear.call(this,t),!this.board["static"]&&t.shadow!==!1&&this.board.theme.get("stone.shadow")&&this.board.layers.shadow.remove(t))}};return h}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.StoneFaded.Service",["ngGo","ngGo.Board.Object.Stone.Service"]).factory("StoneFaded",["Stone",function(t){var e={draw:function(e){e.scale=this.board.theme.get("stone.faded.scale"),e.alpha=this.board.theme.get("stone.faded.alpha",e.color),e.shadow=!1,t.draw.call(this,e)},clear:function(e){e.shadow=!1,t.clear.call(this,e)}};return e}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.StoneMini.Service",["ngGo","ngGo.Board.Object.Stone.Service"]).factory("StoneMini",["Stone",function(t){var e={draw:function(e){e.scale=this.board.theme.get("stone.mini.scale"),e.alpha=this.board.theme.get("stone.mini.alpha",e.color),e.shadow=!1,t.draw.call(this,e)},clear:function(e){e.shadow=!1,t.clear.call(this,e)}};return e}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Board.Object.StoneShadow.Service",["ngGo","ngGo.Board.Object.Service"]).factory("StoneShadow",function(){var t={draw:function(t){if(this.context&&!(t.alpha&&t.alpha<1||t.shadow===!1)){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=Math.max(0,this.board.theme.get("stone.radius",i)-.5);t.scale&&(r=Math.round(r*t.scale));var s=this.board.theme.get("shadow.blur",i),a=this.board.theme.get("shadow.offsetX",i),n=this.board.theme.get("shadow.offsetY",i),h=this.board.theme.get("shadow.color");this.context.fillStyle=this.context.createRadialGradient(e+a,o+n,r-1-s,e+a,o+n,r+s),this.context.fillStyle.addColorStop(0,h),this.context.fillStyle.addColorStop(1,"rgba(0,0,0,0)"),this.context.beginPath(),this.context.arc(e+a,o+n,r+s,0,2*Math.PI,!0),this.context.fill()}},clear:function(t){if(this.context&&!(t.alpha&&t.alpha<1||t.shadow===!1)){var e=this.board.getAbsX(t.x),o=this.board.getAbsY(t.y),i=this.board.getCellSize(),r=this.board.theme.get("stone.radius",i);this.context.clearRect(e-1.2*r,o-1.2*r,2.4*r,2.4*r)}}};return t})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Kifu.Parsers.Gib2Jgf.Service",["ngGo","ngGo.Kifu.Blank.Service"]).factory("Gib2Jgf",["ngGo","KifuBlank",function(t,o){var i=/STO\s0\s([0-9]+)\s(1|2)\s([0-9]+)\s([0-9]+)/gi,r=/GAME(BLACK|WHITE)NAME=([A-Za-z0-9]+)\s\(([0-9]+D|K)\)/gi,s=/GAMEGONGJE=([0-9]+)/gi,a=/GAMEDATE=([0-9]+)-\s?([0-9]+)-\s?([0-9]+)/g,n=/GAMERESULT=(white|black)\s([0-9]+\.?[0-9]?)/gi,h=/GAMERESULT=(white|black)\s[a-z\s]+(resignation|time)/gi,l=function(t,e){"undefined"==typeof t.game.players&&(t.game.players=[]);for(var o="BLACK"===e[1].toUpperCase()?"black":"white",i={color:o,name:e[2],rank:e[3].toLowerCase()},r=0;r<t.game.players.length;r++)if(t.game.players[r].color===o)return void(t.game.players[r]=i);t.game.players.push(i)},c=function(t,e){t.game.komi=parseFloat(e[1]/10)},d=function(t,e){"undefined"==typeof t.game.dates&&(t.game.dates=[]),t.game.dates.push(e[1]+"-"+e[2]+"-"+e[3])},u=function(t,e){var o="black"===e[1].toLowerCase()?"B":"W";o+="+",o+=e[2].match(/res/i)?"R":e[2].match(/time/i)?"T":e[2],t.game.result=o},f=function(t,e,o){var i=o[2];if(1===i)i="B";else{if(2!==i)return;i="W"}e.move={},e.move[i]=[1*o[3],1*o[4]]},p={parse:function(t,p){var g,m=o.jgf(),y=m.tree,v={root:!0};for(y.push(v);g=r.exec(t);)l(m,g);for((g=s.exec(t))&&c(m,g),(g=a.exec(t))&&d(m,g),((g=n.exec(t))||(g=h.exec(t)))&&u(m,g);g=i.exec(t);)v={},f(m,v,g),y.push(v);return p?e.toJson(m):m}};return p}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Kifu.Parsers.Jgf2Sgf.Service",["ngGo","ngGo.Kifu.Blank.Service"]).factory("Jgf2Sgf",["ngGo","sgfAliases","sgfGames","KifuBlank",function(t,o,i,r){var s={};for(var a in o)o.hasOwnProperty(a)&&(s[o[a]]=a);var n="a".charCodeAt(0),h=function(t){return String.fromCharCode(n+t[0])+String.fromCharCode(n+t[1])},l=function(t){return"string"==typeof t?t.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):t},c=function(t,e,o,i){if(e.length){o.sgf+=t;for(var r=0;r<e.length;r++)o.sgf+="["+(i?l(e[r]):e[r])+"]"}},d=function(t,e){var o=t.B?"B":t.W?"W":"";if(""!==o){var i="pass"===t[o]?"":t[o];e.sgf+=o+"["+h(i)+"]"}},u=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){for(var i=0;i<t[o].length;i++)t[o][i]=h(t[o][i]);c("A"+o,t[o],e)}},f=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){for(var i=0;i<t[o].length;i++)t[o][i]=h(t[o][i]);c("T"+o,t[o],e)}},p=function(t,e){for(var o in t)if(t.hasOwnProperty(o)){var i;if("label"===o)for(i=0;i<t[o].length;i++)t[o][i]=h(t[o][i])+":"+t[o][i][2];else for(i=0;i<t[o].length;i++)t[o][i]=h(t[o][i]);"undefined"!=typeof s[o]&&(o=s[o]),c(o,t[o],e)}},g=function(t,e){e.sgf+="PL["+t+"]"},m=function(t,e){for(var o="undefined"!=typeof s.comments?s.comments:"C",i=[],r=0;r<t.length;r++)"string"==typeof t[r]?i.push(t[r]):t[r].comment&&i.push(t[r].comment);c(o,i,e,!0)},y=function(t,e){var o="undefined"!=typeof s.name?s.name:"N";e.sgf+=o+"["+l(t)+"]"},v=function(t){for(var e in i)if(i.hasOwnProperty(e)&&i[e]===t)return e;return 0},b=function(t){var e=t.split(" v");return e.length>1?e[0]+":"+e[1]:t},w=function(t,e){var o=0;t.variationMarkup||(o+=2),t.variationSiblings&&(o+=1),e.ST=o},S=function(t,e){t.width&&t.height?t.width===t.height?e.SZ=t.width:e.SZ=t.width+":"+t.height:t.width?e.SZ=t.width:t.height?e.SZ=t.height:e.SZ=""},x=function(t,e){for(var o=0;o<t.length;o++)if(t[o].color&&("black"===t[o].color||"white"===t[o].color)){var i="black"===t[o].color?"B":"W";t[o].name&&(e["P"+i]=t[o].name),t[o].rank&&(e[i+"R"]=t[o].rank),t[o].team&&(e[i+"T"]=t[o].team)}},k={move:d,setup:u,score:f,markup:p,turn:g,comments:m,name:y,"record.application":b,player:w,board:S,"game.type":v,"game.players":x},P=function(t,o){for(var i=0;i<t.length;i++){var r=t[i];if(e.isArray(r))for(var s=0;s<r.length;s++)o.sgf+="(\n;",P(r[s],o),o.sgf+="\n)";else{for(var a in r)if(r.hasOwnProperty(a)){if("undefined"!=typeof k[a]){k[a](r[a],o);continue}if("object"==typeof r[a])continue;o.sgf+=a+"["+l(r[a])+"]"}i+1<t.length&&(o.sgf+="\n;")}}},C=function(t,e,o){"undefined"==typeof o&&(o="");for(var i in t)if(t.hasOwnProperty(i)){if("sgf"===i)continue;var r=""===o?i:o+"."+i;if("object"==typeof t[i]){"undefined"!=typeof k[r]?k[r](t[i],e):C(t[i],e,r);continue}var a;"undefined"!=typeof s[r]&&(a="undefined"!=typeof k[r]?k[r](t[i]):l(t[i]),e[s[r]]=a)}},M={parse:function(t){if("string"==typeof t&&(t=e.fromJson(t)),!t.tree)return void console.error("No moves tree in JGF object");var o={sgf:"(\n;"},i=e.copy(t),s=r.sgf();t.tree&&t.tree.length>0&&t.tree[0].root&&(i=e.extend(i,t.tree[0]),delete i.root,delete t.tree[0]),delete i.tree,C(i,s);for(var a in s)s[a]&&(o.sgf+=a+"["+l(s[a])+"]");return P(t.tree,o),o.sgf+=")",o.sgf}};return M}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Kifu.Parsers.Sgf2Jgf.Service",["ngGo","ngGo.Kifu.Blank.Service"]).factory("Sgf2Jgf",["ngGo","sgfAliases","sgfGames","KifuBlank",function(t,o,i,r){var s=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g,a=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g,n=/[A-Z]+/,h=/(\[\])|(\[(.|\s)*?([^\\]\]))/g,l="a".charCodeAt(0),c=function(t){return[t.charCodeAt(0)-l,t.charCodeAt(1)-l]},d=function(t,e,o,i){if(!t.record.application){var r=i[0].split(":");r.length>1?t.record.application=r[0]+" v"+r[1]:t.record.application=r[0]}},u=function(){},f=function(t,e,o,r){var s=r[0];"undefined"!=typeof i[s]?t.game.type=i[s]:t.game.type=r[0]},p=function(t,e,o,i){e.move={},""===i[0]||t.width<=19&&"tt"===i[0]?e.move[o]="pass":e.move[o]=c(i[0])},g=function(t,e,i,r){"undefined"!=typeof o[i]&&(i=o[i]),e[i]=r},m=function(t,e,i,r){"undefined"!=typeof o[i]&&(i=o[i]),e[i]=r[0]},y=function(t,e,o,i){"undefined"==typeof e.setup&&(e.setup={}),o=o.charAt(1),"undefined"==typeof e.setup[o]&&(e.setup[o]=[]);for(var r=0;r<i.length;r++)e.setup[o].push(c(i[r]))},v=function(t,e,o,i){"undefined"==typeof e.score&&(e.score={B:[],W:[]}),o=o.charAt(1);for(var r=0;r<i.length;r++)e.score[o].push(c(i[r]))},b=function(t,e,o,i){e.turn=i[0]},w=function(t,e,i,r){"undefined"!=typeof o[i]&&(i=o[i]),"undefined"==typeof e.markup&&(e.markup={}),"undefined"==typeof e.markup[i]&&(e.markup[i]=[]);for(var s=0;s<r.length;s++){var a=c(r[s].substr(0,2));a.push(r[s].substr(3)),e.markup[i].push(a)}},S=function(t,e,i,r){"undefined"!=typeof o[i]&&(i=o[i]),"undefined"==typeof e.markup&&(e.markup={}),"undefined"==typeof e.markup[i]&&(e.markup[i]=[]);for(var s=0;s<r.length;s++)e.markup[i].push(c(r[s]))},x=function(t,e,o,i){"undefined"==typeof t.board&&(t.board={});var r=i[0].split(":");r.length>1?(t.board.width=parseInt(r[0]),t.board.height=parseInt(r[1])):t.board.width=t.board.height=parseInt(r[0])},k=function(t,e,o,i){"undefined"==typeof t.game.dates&&(t.game.dates=[]);for(var r=i[0].split(","),s=0;s<r.length;s++)t.game.dates.push(r[s])},P=function(t,e,o,i){t.game.komi=parseFloat(i[0])},C=function(t,e,o,i){"undefined"==typeof t.player&&(t.player={}),t.player.variationMarkup=!1,t.player.variationChildren=!1,t.player.variationSiblings=!1;var r=parseInt(i[0]);switch(r){case 0:t.player.variationMarkup=!0,t.player.variationChildren=!0;break;case 1:t.player.variationMarkup=!0,t.player.variationSiblings=!0;break;case 2:t.player.variationChildren=!0;break;case 3:t.player.variationSiblings=!0}},M=function(t,e,i,r){"undefined"==typeof t.game.players&&(t.game.players=[]);var s="PB"===i||"BT"===i||"BR"===i?"black":"white";"undefined"!=typeof o[i]&&(i=o[i]);for(var a=0;a<t.game.players.length;a++)if(t.game.players[a].color===s)return void(t.game.players[a][i]=r[0]);var n={color:s};n[i]=r[0],t.game.players.push(n)},A={AP:d,FF:u,GM:f,SZ:x,KM:P,DT:k,ST:C,PB:M,PW:M,BT:M,WT:M,BR:M,WR:M,B:p,W:p,C:g,N:m,AB:y,AW:y,AE:y,PL:b,TW:v,TB:v,CR:S,SQ:S,TR:S,MA:S,SL:S,LB:w},E=["B","W","C","N","AB","AW","AE","PL","LB","CR","SQ","TR","MA","SL","TW","TB"],T=function(t,e,o){if("object"==typeof e){for(var i,r=t,s=0;s<e.length&&(i=e[s],s+1!==e.length);s++)"object"!=typeof r[i]&&(r[i]={}),r=r[i];r[i]=o}},G={parse:function(t,i){var l=r.jgf({record:{sgf:{}}}),c=[],d=l.tree,u={root:!0};d.push(u);for(var f=t.match(s),p=0;p<f.length;p++)if("("!==f[p])if(")"!==f[p]){for(var g=f[p].match(a)||[],m=0;m<g.length;m++){for(var y=n.exec(g[m])[0].toUpperCase(),v=g[m].match(h),b=0;b<v.length;b++)v[b]=v[b].substring(1,v[b].length-1).replace(/\\(?!\\)/g,"");"undefined"==typeof A[y]?(1===v.length&&(v=v[0]),"undefined"==typeof o[y]?u?u[y]=v:l[y]=v:T(l,o[y].split("."),v)):(-1!==E.indexOf(y)&&(u&&"B"!==y&&"W"!==y||(u={},d.push(u))),A[y](l,u,y,v))}u&&!u.root&&(u=null)}else c.length&&(d=c.pop());else{if(0===p||"0"===p)continue;c.push(d),e.isArray(d[d.length-1])||d.push([]),d=d[d.length-1],d.push([]),d=d[d.length-1]}return i?e.toJson(l):l}};return G}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Mode.Common.Service",["ngGo","ngGo.Game.Scorer.Service"]).run(["Player","PlayerModes","PlayerModeCommon",function(t,e,o){t.on("keydown",o.keyDown,[e.REPLAY,e.EDIT]),t.on("mousewheel wheel",o.mouseWheel,[e.REPLAY,e.EDIT]),t.on("mousemove",o.mouseMove,[e.REPLAY,e.EDIT,e.SOLVE]),t.on("mouseout",o.mouseOut,[e.REPLAY,e.EDIT,e.SOLVE]),t.on("mousedown",o.mouseDown,[e.REPLAY,e.EDIT,e.SOLVE]),t.on("mouseup",o.mouseUp,[e.REPLAY,e.EDIT,e.SOLVE])}]).factory("PlayerModeCommon",["Player","PlayerTools","GameScorer","KeyCodes",function(t,o,i,r){function s(t){var e=0,o=0;return"detail"in t&&(o=-1*t.detail),"wheelDelta"in t&&(o=t.wheelDelta),"wheelDeltaY"in t&&(o=t.wheelDeltaY),"wheelDeltaX"in t&&(e=-1*t.wheelDeltaX),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=-1*o,o=0),"deltaY"in t&&(o=-1*t.deltaY),"deltaX"in t&&(e=t.deltaX),t.mouseWheelX=e,t.mouseWheelY=o,t}var a=function(t){var e={start:{x:this.mouse.dragStart.x>t.x?t.x:this.mouse.dragStart.x,y:this.mouse.dragStart.y>t.y?t.y:this.mouse.dragStart.y},stop:{x:this.mouse.dragStart.x>t.x?this.mouse.dragStart.x:t.x,y:this.mouse.dragStart.y>t.y?this.mouse.dragStart.y:t.y}};return e.start.x<0&&(e.start.x=0),e.start.y<0&&(e.start.y=0),e.stop.x>this.board.width-1&&(e.stop.x=this.board.width-1),e.stop.y>this.board.height-1&&(e.stop.y=this.board.height-1),e};e.extend(t,{mouse:{dragStart:null,lastX:-1,lastY:-1}});var n={keyDown:function(t,e){if(this.game&&this.game.isLoaded())switch(e.keyCode){case r.ESC:this.mouse.dragStart=null,this.preventClickEvent=!0;break;case r.RIGHT:this.arrowKeysNavigation&&(e.preventDefault(),this.tool===o.MOVE&&this.game.node!==this.restrictNodeEnd&&this.next());break;case r.LEFT:this.arrowKeysNavigation&&(e.preventDefault(),this.tool===o.MOVE&&this.game.node!==this.restrictNodeStart&&this.previous());break;case r.UP:break;case r.DOWN:}},mouseWheel:function(t,e){if(!this.scrollWheelNavigation||this.tool!==o.MOVE)return!0;if(!this.game||!this.game.isLoaded())return!0;e=s(e);var i=e.mouseWheelY||e.deltaY;0>i?(this.board&&this.board.removeAll("hover"),this.next()):i>0&&(this.board&&this.board.removeAll("hover"),this.previous()),0!==i&&e.preventDefault()},mouseOut:function(){this.board&&this.board.removeAll("hover")},mouseMove:function(t,e){!this.mouse.dragStart||this.mouse.dragStart.x===t.x&&this.mouse.dragStart.y===t.y||(e.drag=a.call(this,t)),this.board&&this.board.layers.hover&&(this.mouse.lastX!==t.x||this.mouse.lastY!==t.y)&&(this.mouse.lastX=t.x,this.mouse.lastY=t.y,this.broadcast("hover",e))},mouseDown:function(t){this.mouse.dragStart={x:t.x,y:t.y}},mouseUp:function(t,e){!this.mouse.dragStart||this.mouse.dragStart.x===t.x&&this.mouse.dragStart.y===t.y||(e.drag=a.call(this,t),this.broadcast("mousedrag",e)),this.mouse.dragStart=null}};return n}])}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Mode.Edit.Service",["ngGo","ngGo.Game.Scorer.Service"]).constant("SetupTools",{BLACK:"black",WHITE:"white",CLEAR:"clear"}).constant("MarkupTools",{TRIANGLE:"triangle",CIRCLE:"circle",SQUARE:"square",MARK:"mark",SELECT:"select",SAD:"sad",HAPPY:"happy",TEXT:"text",NUMBER:"number",CLEAR:"clear"}).run(["Player","PlayerModes","PlayerModeEdit",function(t,e,o){t.on("pathChange",o.pathChange,e.EDIT),t.on("toolSwitch",o.toolSwitch,e.EDIT),t.on("modeEnter",o.modeEnter,e.EDIT),t.on("mousedrag",o.mouseDrag,e.EDIT),t.on("keydown",o.keyDown,e.EDIT),t.on("click",o.click,e.EDIT),t.on("hover",o.hover,e.EDIT),t.registerMode(e.EDIT,o)}]).provider("PlayerModeEdit",function(){var t={};this.setConfig=function(o){t=e.extend(t,o)},this.$get=["Player","PlayerTools","SetupTools","MarkupTools","MarkupTypes","GameScorer","StoneColor",function(t,o,i,r,s,a,n){var h="A".charCodeAt(0),l="a".charCodeAt(0),c=function(t,e,a){if(("undefined"==typeof t||"undefined"==typeof e)&&(t=this.mouse.lastX,e=this.mouse.lastY),this.board&&this.board.isOnBoard(t,e))switch(this.tool){case o.SETUP:this.setupTool===i.CLEAR?this.game.hasStone(t,e)&&this.board.add("hover",t,e,{type:"markup",value:s.MARK}):this.game.hasStone(t,e,this.setupToolColor())?a||this.board.add("hover",t,e,{type:"markup",value:s.MARK}):this.board.add("hover",t,e,{type:"stones",value:this.setupToolColor()});break;case o.MARKUP:this.markupTool===r.CLEAR||this.game.hasMarkup(t,e)?this.game.hasMarkup(t,e)&&this.board.add("hover",t,e,{type:"markup",value:s.MARK}):this.markupTool===r.TEXT||this.markupTool===r.NUMBER?this.board.add("hover",t,e,{type:"markup",value:{type:s.LABEL,text:this.markupLabel}}):this.board.add("hover",t,e,{type:"markup",value:this.markupTool});break;case o.MOVE:!this.game.hasStone(t,e)&&this.game.isValidMove(t,e)&&this.board.add("hover",t,e,{type:"stones",value:this.game.getTurn()});break;case o.SCORE:this.game.hasStone(t,e)&&this.board.add("hover",t,e,{type:"markup",value:s.MARK})}},d=function(t,e){if(this.game.hasMarkup(t,e)){var o=this.game.getMarkup(t,e);if(o.type===s.LABEL&&o.text){var i=this.markupLabels.indexOf(o.text);-1!==i&&this.markupLabels.splice(i,1)}return void this.game.removeMarkup(t,e)}this.markupTool!==r.CLEAR&&(this.markupTool===r.TEXT?(this.game.addMarkup(t,e,{type:s.LABEL,text:this.markupLabel}),this.markupLabels.push(this.markupLabel),this.determineMarkupLabel()):this.markupTool===r.NUMBER?(this.game.addMarkup(t,e,{type:s.LABEL,text:this.markupLabel}),this.markupLabels.push(this.markupLabel),this.determineMarkupLabel()):this.game.addMarkup(t,e,this.markupTool))},u=function(t,e,o){var i=this.setupToolColor();if(i===n.EMPTY)this.game.removeStone(t,e);else{if(!o&&this.game.hasStone(t,e,i))return void this.game.removeStone(t,e);this.game.hasStone(t,e)&&this.game.removeStone(t,e),this.game.addStone(t,e,i)}this.board.layers.markup.redrawCell(t,e)},f=function(){if(this.markupLabels=[],this.game&&this.game.isLoaded())for(var t=this.game.position.markup.all("type"),e=0;e<t.length;e++)t[e].type===s.LABEL&&""!==t[e].text&&this.markupLabels.push(t[e].text)};e.extend(t,{setupTool:i.BLACK,markupTool:r.TRIANGLE,markupLabels:[],markupLabel:"",switchSetupTool:function(t){this.setupTool=t},switchMarkupTool:function(t){this.markupTool=t,(this.markupTool===r.TEXT||this.markupTool===r.NUMBER)&&this.determineMarkupLabel()},setupToolColor:function(){
switch(this.setupTool){case i.BLACK:return n.B;case i.WHITE:return n.W;default:return n.EMPTY}},setMarkupLabel:function(t){t&&(this.markupLabel=t)},determineMarkupLabel:function(){switch(this.markupLabel="",this.markupTool){case r.TEXT:for(var t=0;!this.markupLabel||-1!==this.markupLabels.indexOf(this.markupLabel);)26>t?this.markupLabel=String.fromCharCode(h+t):52>t?this.markupLabel=String.fromCharCode(l+t-26):this.markupLabel=String.fromCharCode(h+Math.floor(t/26)-2)+String.fromCharCode(h+t%26),t++;break;case r.NUMBER:for(this.markupLabel=0;0===this.markupLabel||-1!==this.markupLabels.indexOf(this.markupLabel);)this.markupLabel++}}});var p={hover:function(t){if(this.board){if(this.board.removeAll("hover"),!t.drag||this.tool!==o.SETUP&&this.tool!==o.MARKUP)return void c.call(this);if(this.markupTool===r.TEXT||this.markupTool===r.NUMBER)return void c.call(this);for(var e=t.drag.start.x;e<=t.drag.stop.x;e++)for(var i=t.drag.start.y;i<=t.drag.stop.y;i++)c.call(this,e,i,!0)}},keyDown:function(t,e){e.keyCode},click:function(t){if(this.board&&this.board.isOnBoard(t.x,t.y)){switch(this.board.removeAll("hover"),this.tool){case o.MOVE:if(!this.game.play(t.x,t.y))return;this.processPosition();break;case o.SETUP:u.call(this,t.x,t.y),this.processPosition();break;case o.MARKUP:d.call(this,t.x,t.y),this.processPosition();break;case o.SCORE:a.mark(t.x,t.y),this.scoreGame()}p.hover.call(this,t)}},mouseDrag:function(t){var e,i;switch(this.board&&this.board.removeAll("hover"),this.tool){case o.SETUP:for(e=t.drag.start.x;e<=t.drag.stop.x;e++)for(i=t.drag.start.y;i<=t.drag.stop.y;i++)u.call(this,e,i,!0);this.processPosition();break;case o.MARKUP:if(this.markupTool===r.TEXT||this.markupTool===r.NUMBER)break;for(e=t.drag.start.x;e<=t.drag.stop.x;e++)for(i=t.drag.start.y;i<=t.drag.stop.y;i++)d.call(this,e,i);this.processPosition()}p.hover.call(this,t)},pathChange:function(){f.call(this)},modeEnter:function(){this.setTools([o.MOVE,o.SETUP,o.MARKUP,o.SCORE]),this.tool=this.tools[0],f.call(this)},toolSwitch:function(){this.tool===o.SCORE?(this.statePreScoring=this.board.getState(),a.load(this.game),this.scoreGame()):this.statePreScoring&&(this.board.restoreState(this.statePreScoring),delete this.statePreScoring)}};return p}]})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Mode.Replay.Service",["ngGo","ngGo.Game.Scorer.Service"]).run(["Player","PlayerModes","PlayerModeReplay",function(t,e,o){t.on("settingChange",o.settingChange,e.REPLAY),t.on("boardUpdate",o.boardUpdate,e.REPLAY),t.on("pathChange",o.pathChange,e.REPLAY),t.on("toolSwitch",o.toolSwitch,e.REPLAY),t.on("modeEnter",o.modeEnter,e.REPLAY),t.on("modeExit",o.modeExit,e.REPLAY),t.on("click",o.click,e.REPLAY),t.on("hover",o.hover,e.REPLAY),t.registerMode(e.REPLAY,o)}]).provider("PlayerModeReplay",function(){var t={autoPlayDelay:1e3};this.setConfig=function(o){t=e.extend(t,o)},this.$get=["$interval","Player","PlayerModes","PlayerTools","MarkupTypes","GameScorer",function(o,i,r,s,a,n){var h=function(t,e){if(("undefined"==typeof t||"undefined"==typeof e)&&(t=this.mouse.lastX,e=this.mouse.lastY),this.board&&this.board.isOnBoard(t,e))switch(this.tool){case s.MOVE:!this.game.hasStone(t,e)&&this.game.isMoveVariation(t,e)&&this.board.add("hover",t,e,{type:"stones",value:this.game.getTurn()});break;case s.SCORE:this.game.hasStone(t,e)&&this.board.add("hover",t,e,{type:"markup",value:a.MARK})}},l=function(t){for(var e=0;e<t.length;e++)this.board.has("markup",t[e].move.x,t[e].move.y)||this.board.add("markup",t[e].move.x,t[e].move.y,{type:this.board.theme.get("markup.variation.type"),text:this.board.theme.get("markup.variation.text",e),color:this.board.theme.get("markup.variation.color")})},c=function(t){for(var e=0;e<t.length;e++)this.board.remove("markup",t[e].move.x,t[e].move.y)},d=function(t){if(this.board&&this.game&&this.game.isLoaded()){var e,o=this.game.getNode();o&&(this.variationChildren&&o.hasMoveVariations()&&(e=o.getMoveVariations(),t?l.call(this,e):c.call(this,e)),this.variationSiblings&&o.parent&&o.parent.hasMoveVariations()&&(e=o.parent.getMoveVariations(),t?l.call(this,e):c.call(this,e)))}};e.extend(i,{autoPlaying:!1,autoPlayDelay:1e3,autoPlayPromise:null,setAutoPlayDelay:function(t){this.autoPlayDelay!==t&&(this.autoPlayDelay=t,this.broadcast("settingChange","autoPlayDelay"))},start:function(t){if(this.mode===r.REPLAY&&!this.autoPlaying&&this.game&&this.game.node.hasChildren()){var e=this;t="number"==typeof t?t:this.autoPlayDelay,this.switchTool(s.NONE),this.autoPlaying=!0,this.autoPlayPromise=o(function(){e.next(0,!0),e.game.node.hasChildren()||e.stop()},t),this.broadcast("autoPlayStarted",this.game.node)}},stop:function(){this.mode===r.REPLAY&&this.autoPlaying&&(this.autoPlayPromise&&o.cancel(this.autoPlayPromise),this.autoPlayPromise=null,this.autoPlaying=!1,this.broadcast("autoPlayStopped",this.game.node))}});var u={parseConfig:function(o){this.config=e.extend({},this.config,t,o||{}),this.setAutoPlayDelay(this.config.autoPlayDelay)},settingChange:function(t,e){"variationMarkup"===e&&d.call(this,this.variationMarkup)},hover:function(){this.board&&(this.board.removeAll("hover"),h.call(this))},boardUpdate:function(){this.variationMarkup&&d.call(this,!0)},click:function(t){if(this.board&&this.board.isOnBoard(t.x,t.y)){switch(this.tool){case s.MOVE:this.game.isMoveVariation(t.x,t.y)&&this.next(this.game.getMoveVariation(t.x,t.y));break;case s.SCORE:n.mark(t.x,t.y),this.scoreGame()}u.hover.call(this,t)}},pathChange:function(){this.board&&(this.board.removeAll("hover"),h.call(this))},modeEnter:function(){this.setTools([s.MOVE,s.SCORE,s.NONE]),this.tool=this.tools[0],this.variationMarkup&&d.call(this,!0)},modeExit:function(){this.autoPlaying&&this.stop(),this.variationMarkup&&d.call(this,!1)},toolSwitch:function(){this.tool===s.SCORE?(this.statePreScoring=this.board.getState(),n.load(this.game),this.scoreGame()):this.statePreScoring&&(this.board.restoreState(this.statePreScoring),delete this.statePreScoring)}};return u}]})}(window,window.angular),function(t,e,o){"use strict";e.module("ngGo.Player.Mode.Solve.Service",["ngGo"]).run(["Player","PlayerModes","PlayerModeSolve",function(t,e,o){t.on("settingChange",o.settingChange,e.SOLVE),t.on("boardUpdate",o.boardUpdate,e.SOLVE),t.on("pathChange",o.pathChange,e.SOLVE),t.on("modeEnter",o.modeEnter,e.SOLVE),t.on("modeExit",o.modeExit,e.SOLVE),t.on("keydown",o.keyDown,e.SOLVE),t.on("click",o.click,e.SOLVE),t.on("hover",o.hover,e.SOLVE),t.registerMode(e.SOLVE,o)}]).provider("PlayerModeSolve",["StoneColor",function(t){var o={playerColor:t.B,solutionPaths:!1,solveAutoPlay:!0,solveAutoPlayDelay:500};this.setConfig=function(t){o=e.extend(o,t)},this.$get=["$timeout","Player","PlayerModes","PlayerTools","KeyCodes",function(t,i,r,s,a){var n=function(){return this.solveAutoPlay?this.problemSolved?!0:this.problemOffPath?!0:this.game.getTurn()===this.playerColor?!0:!1:!0},h=function(t,e){if(("undefined"==typeof t||"undefined"==typeof e)&&(t=this.mouse.lastX,e=this.mouse.lastY),this.board&&this.board.isOnBoard(t,e))switch(this.tool){case s.MOVE:n.call(this)&&this.game.isValidMove(t,e)&&this.board.add("hover",t,e,{type:"stones",value:this.game.getTurn()})}},l=function(t){for(var e=0;e<t.length;e++)t[e].solution===!0?this.board.add("markup",t[e].move.x,t[e].move.y,{type:this.board.theme.get("markup.solution.valid.type"),text:this.board.theme.get("markup.solution.valid.text",e),scale:this.board.theme.get("markup.solution.valid.scale"),color:this.board.theme.get("markup.solution.valid.color")}):this.board.add("markup",t[e].move.x,t[e].move.y,{type:this.board.theme.get("markup.solution.invalid.type"),text:this.board.theme.get("markup.solution.invalid.text",e),scale:this.board.theme.get("markup.solution.invalid.scale"),color:this.board.theme.get("markup.solution.invalid.color")})},c=function(t){for(var e=0;e<t.length;e++)this.board.remove("markup",t[e].move.x,t[e].move.y)},d=function(t){if(this.board&&this.game&&this.game.isLoaded()){var e=this.game.getNode(),o=e.getMoveVariations();return t&&!this.problemSolved&&this.solveAutoPlay&&this.game.getTurn()!==this.playerColor?void c.call(this,o):void(t?l.call(this,o):c.call(this,o))}};e.extend(i,{problemSolved:!1,problemOffPath:!1,problemStartPath:null,playerColor:0,solutionPaths:!1,solveAutoPlay:!0,solveAutoPlayDelay:500,solveNavigationBlocked:!1,setSolveAutoPlay:function(t){this.solveAutoPlay!==t&&(this.solveAutoPlay=t,this.broadcast("settingChange","solveAutoPlay"))},setSolveAutoPlayDelay:function(t){this.solveAutoPlayDelay!==t&&(this.solveAutoPlayDelay=t,this.broadcast("settingChange","solveAutoPlayDelay"))},setPlayerColor:function(t){this.playerColor!==t&&(this.playerColor=t,this.broadcast("settingChange","playerColor"))},getPlayerColor:function(t){return t&&this.board?this.board.colorMultiplier*this.playerColor:this.playerColor},toggleSolutionPaths:function(t){"undefined"==typeof t&&(t=!this.solutionPaths),t!==this.solutionPaths&&(this.solutionPaths=t,this.broadcast("settingChange","solutionPaths"))},autoPlayNext:function(e){if(this.game&&this.game.isLoaded()&&0!==this.game.node.children.length){var o,i=[],r=this;for(o=0;o<this.game.node.children.length;o++)this.game.node.children[o].solution&&i.push(this.game.node.children[o]);if(0===i.length&&(i=this.game.node.children),o=Math.floor(Math.random()*i.length),e||!this.solveAutoPlayDelay)return void this.next(i[o]);this.solveNavigationBlocked=!0,t(function(){r.next(i[o]),r.solveNavigationBlocked=!1},this.solveAutoPlayDelay)}},solve:function(){return this.game&&this.game.isLoaded()?(this.problemSolved=!1,this.problemOffPath=!1,this.problemStartPath=this.game.getPath(!0),this.restrictNode(),void(this.solveAutoPlay&&this.game.getTurn()!==this.playerColor&&this.autoPlayNext())):!1},restartProblem:function(){this.mode===r.SOLVE&&this.game&&this.game.isLoaded()&&(this.problemSolved=!1,this.problemOffPath=!1,this.problemStartPath&&this["goto"](this.problemStartPath),this.solveAutoPlay&&this.game.getTurn()!==this.playerColor&&this.autoPlayNext())}});var u={parseConfig:function(t){this.config=e.extend({},this.config,o,t||{}),this.toggleSolutionPaths(this.config.solutionPaths),this.setPlayerColor(this.config.playerColor),this.setSolveAutoPlay(this.config.solveAutoPlay),this.setSolveAutoPlayDelay(this.config.solveAutoPlayDelay)},settingChange:function(t,e){"solutionPaths"===e&&d.call(this,this.solutionPaths),"playerColor"===e&&(d.call(this,this.solutionPaths),!this.problemSolved&&this.solveAutoPlay&&this.game.getTurn()!==this.playerColor&&this.autoPlayNext(!0))},hover:function(t){this.board&&(this.board.removeAll("hover"),h.call(this,t.x,t.y))},boardUpdate:function(){this.solutionPaths&&d.call(this,!0)},keyDown:function(t,e){switch(e.keyCode){case a.RIGHT:this.arrowKeysNavigation&&(e.preventDefault(),this.solveNavigationBlocked||this.game.node===this.restrictNodeEnd||this.problemSolved&&this.next());break;case a.LEFT:this.arrowKeysNavigation&&(e.preventDefault(),this.solveNavigationBlocked||this.game.node===this.restrictNodeStart||(this.previous(),!this.problemSolved&&this.solveAutoPlay&&this.game.getTurn()===-this.playerColor&&this.previous()))}},click:function(t){if(this.board&&this.board.isOnBoard(t.x,t.y))if(this.game.isMoveVariation(t.x,t.y)){var e=this.game.getMoveVariation(t.x,t.y);this.next(e);var o=this.game.getNode();0===o.children.length?o.solution===!0?(this.problemSolved=!0,this.broadcast("solutionFound",o)):this.broadcast("solutionWrong",o):!this.problemSolved&&this.solveAutoPlay&&this.autoPlayNext()}else this.game.play(t.x,t.y)&&(this.problemOffPath=!0,this.processPosition(),this.broadcast("solutionOffPath",this.game.getNode()))},pathChange:function(){this.board&&(this.board.removeAll("hover"),h.call(this))},modeEnter:function(){this.setTools([s.MOVE]),this.tool=this.tools[0],this.solutionPaths&&d.call(this,!0)},modeExit:function(){this.solutionPaths&&d.call(this,!1)}};return u}]}])}(window,window.angular);
//# sourceMappingURL=ngGo.min.js.map
